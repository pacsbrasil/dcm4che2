/* ***** BEGIN LICENSE BLOCK *****
 * Version: MPL 1.1/GPL 2.0/LGPL 2.1
 *
 * The contents of this file are subject to the Mozilla Public License Version
 * 1.1 (the "License"); you may not use this file except in compliance with
 * the License. You may obtain a copy of the License at
 * http://www.mozilla.org/MPL/
 *
 * Software distributed under the License is distributed on an "AS IS" basis,
 * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
 * for the specific language governing rights and limitations under the
 * License.
 *
 *
 * The Initial Developer of the Original Code is
 * Raster Images
 * Portions created by the Initial Developer are Copyright (C) 2009-2010
 * the Initial Developer. All Rights Reserved.
 *
 * Contributor(s):
 * Babu Hussain A
 * Meer Asgar Hussain B
 * Prakash J
 * Suresh V
 *
 * Alternatively, the contents of this file may be used under the terms of
 * either the GNU General Public License Version 2 or later (the "GPL"), or
 * the GNU Lesser General Public License Version 2.1 or later (the "LGPL"),
 * in which case the provisions of the GPL or the LGPL are applicable instead
 * of those above. If you wish to allow use of your version of this file only
 * under the terms of either the GPL or the LGPL, and not to allow others to
 * use your version of this file under the terms of the MPL, indicate your
 * decision by deleting the provisions above and replace them with the notice
 * and other provisions required by the GPL or the LGPL. If you do not delete
 * the provisions above, a recipient may use your version of this file under
 * the terms of any one of the MPL, the GPL or the LGPL.
 *
 * ***** END LICENSE BLOCK ***** */
package in.raster.mayam.form;

import in.raster.mayam.context.ApplicationContext;
import in.raster.mayam.model.Study;
import in.raster.mayam.model.combo.ModalityComboModel;
import javax.swing.JComboBox;

/**
 *
 * @author  BabuHussain
 * @version 0.5
 *
 */
public class LayoutManagerPanel extends javax.swing.JPanel {

    /** Creates new form LayoutManagerPanel */
    private boolean multiframeStatus;
    public static boolean updateSeries = false;
    public static boolean updatePropertiesDetails;

    public LayoutManagerPanel() {
        initComponents();
        initializeDefault();
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        layoutLabel = new javax.swing.JLabel();
        modalityLabel = new javax.swing.JLabel();
        jComboBox1 = new javax.swing.JComboBox();
        jPanel1 = new javax.swing.JPanel();
        rowsLabel = new javax.swing.JLabel();
        columnsLabel = new javax.swing.JLabel();
        jSpinner1 = new javax.swing.JSpinner();
        jSpinner2 = new javax.swing.JSpinner();
        multiframe = new javax.swing.JCheckBox();

        layoutLabel.setBackground(new java.awt.Color(0, 0, 0));
        layoutLabel.setFont(new java.awt.Font("Lucida Grande", 1, 14));
        layoutLabel.setForeground(new java.awt.Color(255, 138, 0));
        java.util.ResourceBundle bundle = java.util.ResourceBundle.getBundle("in/raster/mayam/form/i18n/Bundle",ApplicationContext.currentLocale); // NOI18N
        layoutLabel.setText(bundle.getString("LayoutManagerPanel.layoutLabel.text_1")); // NOI18N
        layoutLabel.setOpaque(true);

        modalityLabel.setText(bundle.getString("LayoutManagerPanel.modalityLabel.text_1")); // NOI18N

        jComboBox1.setModel(new ModalityComboModel(ApplicationContext.databaseRef.getModalities()));
        jComboBox1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jComboBox1ActionPerformed(evt);
            }
        });

        jPanel1.setBorder(javax.swing.BorderFactory.createTitledBorder(bundle.getString("LayoutManagerPanel.jPanel1.border.title_1"))); // NOI18N

        rowsLabel.setText(bundle.getString("LayoutManagerPanel.rowsLabel.text_1")); // NOI18N

        columnsLabel.setText(bundle.getString("LayoutManagerPanel.columnsLabel.text_1")); // NOI18N

        org.jdesktop.layout.GroupLayout jPanel1Layout = new org.jdesktop.layout.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(jPanel1Layout.createSequentialGroup()
                .add(18, 18, 18)
                .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                    .add(rowsLabel)
                    .add(jSpinner1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 46, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, 51, Short.MAX_VALUE)
                .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                    .add(jSpinner2, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 46, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                    .add(columnsLabel))
                .add(45, 45, 45))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(rowsLabel)
                    .add(columnsLabel))
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(jSpinner1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                    .add(jSpinner2, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        multiframe.setText(bundle.getString("LayoutManagerPanel.multiframe.text_1")); // NOI18N
        multiframe.addItemListener(new java.awt.event.ItemListener() {
            public void itemStateChanged(java.awt.event.ItemEvent evt) {
                multiframeItemStateChanged(evt);
            }
        });

        org.jdesktop.layout.GroupLayout layout = new org.jdesktop.layout.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(layoutLabel, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 437, Short.MAX_VALUE)
            .add(org.jdesktop.layout.GroupLayout.TRAILING, layout.createSequentialGroup()
                .addContainerGap(96, Short.MAX_VALUE)
                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                    .add(layout.createSequentialGroup()
                        .add(7, 7, 7)
                        .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING, false)
                            .add(jPanel1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .add(jComboBox1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 79, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                            .add(modalityLabel)))
                    .add(multiframe))
                .add(80, 80, 80))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(layout.createSequentialGroup()
                .add(layoutLabel, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 24, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.UNRELATED)
                .add(modalityLabel)
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.UNRELATED)
                .add(jComboBox1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                .add(18, 18, 18)
                .add(jPanel1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                .add(18, 18, 18)
                .add(multiframe)
                .addContainerGap(142, Short.MAX_VALUE))
        );
    }// </editor-fold>//GEN-END:initComponents

    private void jComboBox1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jComboBox1ActionPerformed
        int rowColumn[] = ApplicationContext.databaseRef.getRowColumnForModality((String) ((JComboBox) evt.getSource()).getSelectedItem());
        jSpinner1.setValue(rowColumn[0]);
        jSpinner2.setValue(rowColumn[1]);
    }//GEN-LAST:event_jComboBox1ActionPerformed

    private void multiframeItemStateChanged(java.awt.event.ItemEvent evt) {//GEN-FIRST:event_multiframeItemStateChanged
        if (multiframe.isSelected()) {
            updatePropertiesDetails = true;
        } else {
            updatePropertiesDetails = false;
        }
    }//GEN-LAST:event_multiframeItemStateChanged
    public void initializeDefault() {
        jComboBox1.setSelectedIndex(0);
        int rowColumn[] = ApplicationContext.databaseRef.getRowColumnForModality((String) jComboBox1.getSelectedItem());
        jSpinner1.setValue(rowColumn[0]);
        jSpinner2.setValue(rowColumn[1]);
        multiframeStatus = ApplicationContext.databaseRef.getMultiframeStatus();
        multiframe.setSelected(ApplicationContext.databaseRef.getMultiframeStatus());
    }

    public void updateSeriesDisplayModification() {
        if (multiframeStatus != multiframe.isSelected()) {
            if (ApplicationContext.imageViewExist()) {
                updateSeries = true;
                ApplicationContext.imgView.dispose();
            } else {

                if (updatePropertiesDetails) {
                    ApplicationContext.databaseRef.updatePropertiesDetail("true");
                } else {
                    ApplicationContext.databaseRef.updatePropertiesDetail("false");
                }
                for (Study study : MainScreen.studyList) {
                    if (study.getStudyInstanceUID().equalsIgnoreCase(MainScreen.selectedStudy)) {
                        MainScreen.studyList.remove(study);
                        ApplicationContext.mainScreen.showThumbnails();
                    }
                }
            }
        }
    }

    private void updateSeriesDisplay() {
    }

    public String[] getModalityLayoutDetail() {
        String temp[] = new String[3];
        String modality = (String) jComboBox1.getSelectedItem();
        String rowCount = jSpinner1.getValue().toString();
        String columnCount = jSpinner2.getValue().toString();
        temp[0] = modality;
        temp[1] = rowCount;
        temp[2] = columnCount;
        return temp;

    }

    public JComboBox getModalityCombo() {
        return jComboBox1;
    }
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JLabel columnsLabel;
    private javax.swing.JComboBox jComboBox1;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JSpinner jSpinner1;
    private javax.swing.JSpinner jSpinner2;
    private javax.swing.JLabel layoutLabel;
    private javax.swing.JLabel modalityLabel;
    private javax.swing.JCheckBox multiframe;
    private javax.swing.JLabel rowsLabel;
    // End of variables declaration//GEN-END:variables
}