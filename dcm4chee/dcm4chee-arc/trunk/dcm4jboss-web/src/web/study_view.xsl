<?xml version="1.0" encoding="UTF-8"?>
<!--
 $Id$
 -->
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:output method="html" indent="no" encoding="ISO-8859-1"/>
   
<xsl:template match="/model">
<html>
<head>
   <title><xsl:value-of select="patient/patientName" /> (<xsl:value-of select="patient/patientSex" />)</title>
</head>
<body>
	<script language="JavaScript"><xsl:text>&lt;!--
        	var W=600,H=600;
                if (parseInt(navigator.appVersion)>3) 
		{
			if (navigator.appName=="Netscape") 
			{
				W = window.innerWidth-20;
				H = window.innerHeight-35;
			}
			if (navigator.appName.indexOf("Microsoft")!=-1) 
			{
				W = document.body.offsetWidth-30;
				H = document.body.offsetHeight-35;
			}
			else
			{
				W = window.innerWidth-15;
				H = window.innerHeight-20;
			}
		}
	//--&gt;</xsl:text></script>

	<script LANGUAGE="JavaScript"><xsl:text>&lt;!--
    		var _info = navigator.userAgent; 
    		var _ns = false; 
    		var _ns6 = false;
    		var _ie = (_info.indexOf("MSIE") &gt; 0 &amp;&amp; _info.indexOf("Win") &gt; 0 &amp;&amp; _info.indexOf("Windows 3.1") &lt; 0);
	//--&gt;</xsl:text></script>
    	<comment>
        	<script LANGUAGE="JavaScript1.1"><xsl:text>&lt;!--
        		var _ns = (navigator.appName.indexOf("Netscape") &gt;= 0 &amp;&amp; ((_info.indexOf("Win") &gt; 0 &amp;&amp; _info.indexOf("Win16") &lt; 0 &amp;&amp; java.lang.System.getProperty("os.version").indexOf("3.5") &lt; 0) || (_info.indexOf("Sun") &gt; 0) || (_info.indexOf("Linux") &gt; 0) || (_info.indexOf("AIX") &gt; 0) || (_info.indexOf("OS/2") &gt; 0) || (_info.indexOf("IRIX") &gt; 0)));
        		var _ns6 = ((_ns == true) &amp;&amp; (_info.indexOf("Mozilla/5") &gt;= 0));
		//--&gt;</xsl:text></script>
    	</comment>

	<script LANGUAGE="JavaScript"><xsl:text>&lt;!--
    		if (_ie == true) 
			document.writeln('&lt;object classid="clsid:8AD9C840-044E-11D1-B3E9-00805F499D93" WIDTH = '+W+' HEIGHT = '+H+'  codebase="http://java.sun.com/products/plugin/autodl/jinstall-1_4-windows-i586.cab#Version=1,4,0,0" &gt; \
			&lt;noembed&gt; &lt;XMP&gt;\
			&lt;APPLET  CODE = "com.tiani.jvision.applet.DisplayApplet.class" ARCHIVE = "../WebViewer/jvapplet.jar" WIDTH = "600" HEIGHT = "600" &gt; &lt;/XMP&gt;\
		                       &lt;PARAM NAME = "CODE" VALUE = "com.tiani.jvision.applet.DisplayApplet.class" /&gt; \
		    	        &lt;PARAM NAME = "ARCHIVE" VALUE = "../WebViewer/jvapplet.jar" /&gt; \
			        &lt;PARAM NAME = "DB_FIRST_NAME" VALUE="</xsl:text><xsl:call-template name="firstName" /><xsl:text>" /&gt; \
			        &lt;PARAM NAME ="DB_LAST_NAME" VALUE ="</xsl:text><xsl:call-template name="lastName" /><xsl:text>"/&gt; \
			        &lt;PARAM NAME ="DB_SEX" VALUE ="</xsl:text><xsl:value-of select="patient/patientSex" /><xsl:text>" /&gt; \
			        &lt;PARAM NAME ="DB_BIRTH_DATE" VALUE ="</xsl:text><xsl:value-of select="patient/patientBirthDate" /><xsl:text>" /&gt; \
			        &lt;PARAM NAME = "SELECT_SEQUENCE" VALUE="</xsl:text><xsl:value-of select="selectedSeries" /><xsl:text>" /&gt; \
			        </xsl:text>    <xsl:apply-templates select="studyContainer/series/item"/>
    		                        <xsl:text>&lt;PARAM NAME = "IMAGE_SERVLET" VALUE ="/WebViewer/servlet/GetImageServlet?IMGUID=" /&gt;  \
    			        &lt;PARAM NAME="type" VALUE="application/x-java-applet;version=1.4" /&gt; \
    			        &lt;PARAM NAME="scriptable" VALUE="false" /&gt; \
			&lt;/APPLET&gt; \
			&lt;/noembed&gt; \
			&lt;/object&gt;');
    		else if (_ns == true &amp;&amp; _ns6 == false) 
			document.writeln('&lt;embed \
	    			type="application/x-java-applet;version=1.4" \
            			CODE = "com.tiani.jvision.applet.DisplayApplet.class" \
            			ARCHIVE = "../WebViewer/jvapplet.jar" \
            			WIDTH = '+W+' \
            			HEIGHT ='+H+' \
				DB_FIRST_NAME="KLAUS-DIETER" DB_LAST_NAME="UNRATH" DB_SEX="M" DB_BIRTH_DATE="19390503" SELECT_SEQUENCE="1" SEQUENCE1="Seq. Nr. 1;1.2.840.113619.2.55.1.1762895154.2356.1113547738.859.1;1.2.840.113619.2.55.1.1762895154.2356.1113547738.860.2" SEQUENCE2="Seq. Nr. 1;1.2.840.113619.2.55.1.1762895154.2356.1113547738.978.1;1.2.840.113619.2.55.1.1762895154.2356.1113547738.979.2" SEQUENCE3="Seq. Nr. 2;1.2.840.113619.2.55.1.1762895154.2356.1113547738.862.1;1.2.840.113619.2.55.1.1762895154.2356.1113547738.863.2;1.2.840.113619.2.55.1.1762895154.2356.1113547738.864.3;1.2.840.113619.2.55.1.1762895154.2356.1113547738.865.4;1.2.840.113619.2.55.1.1762895154.2356.1113547738.866.5;1.2.840.113619.2.55.1.1762895154.2356.1113547738.867.6;1.2.840.113619.2.55.1.1762895154.2356.1113547738.868.7;1.2.840.113619.2.55.1.1762895154.2356.1113547738.869.8;1.2.840.113619.2.55.1.1762895154.2356.1113547738.870.9;1.2.840.113619.2.55.1.1762895154.2356.1113547738.871.10;1.2.840.113619.2.55.1.1762895154.2356.1113547738.872.11;1.2.840.113619.2.55.1.1762895154.2356.1113547738.873.12;1.2.840.113619.2.55.1.1762895154.2356.1113547738.874.13;1.2.840.113619.2.55.1.1762895154.2356.1113547738.875.14;1.2.840.113619.2.55.1.1762895154.2356.1113547738.876.15;1.2.840.113619.2.55.1.1762895154.2356.1113547738.877.16;1.2.840.113619.2.55.1.1762895154.2356.1113547738.878.17;1.2.840.113619.2.55.1.1762895154.2356.1113547738.879.18;1.2.840.113619.2.55.1.1762895154.2356.1113547738.880.19;1.2.840.113619.2.55.1.1762895154.2356.1113547738.881.20;1.2.840.113619.2.55.1.1762895154.2356.1113547738.882.21;1.2.840.113619.2.55.1.1762895154.2356.1113547738.883.22;1.2.840.113619.2.55.1.1762895154.2356.1113547738.884.23;1.2.840.113619.2.55.1.1762895154.2356.1113547738.885.24;1.2.840.113619.2.55.1.1762895154.2356.1113547738.886.25;1.2.840.113619.2.55.1.1762895154.2356.1113547738.887.26;1.2.840.113619.2.55.1.1762895154.2356.1113547738.888.27;1.2.840.113619.2.55.1.1762895154.2356.1113547738.889.28;1.2.840.113619.2.55.1.1762895154.2356.1113547738.890.29;1.2.840.113619.2.55.1.1762895154.2356.1113547738.891.30;1.2.840.113619.2.55.1.1762895154.2356.1113547738.892.31;1.2.840.113619.2.55.1.1762895154.2356.1113547738.893.32;1.2.840.113619.2.55.1.1762895154.2356.1113547738.894.33;1.2.840.113619.2.55.1.1762895154.2356.1113547738.895.34;1.2.840.113619.2.55.1.1762895154.2356.1113547738.896.35;1.2.840.113619.2.55.1.1762895154.2356.1113547738.897.36;1.2.840.113619.2.55.1.1762895154.2356.1113547738.898.37;1.2.840.113619.2.55.1.1762895154.2356.1113547738.899.38;1.2.840.113619.2.55.1.1762895154.2356.1113547738.900.39;1.2.840.113619.2.55.1.1762895154.2356.1113547738.901.40;1.2.840.113619.2.55.1.1762895154.2356.1113547738.902.41;1.2.840.113619.2.55.1.1762895154.2356.1113547738.903.42;1.2.840.113619.2.55.1.1762895154.2356.1113547738.904.43;1.2.840.113619.2.55.1.1762895154.2356.1113547738.905.44;1.2.840.113619.2.55.1.1762895154.2356.1113547738.906.45;1.2.840.113619.2.55.1.1762895154.2356.1113547738.907.46;1.2.840.113619.2.55.1.1762895154.2356.1113547738.908.47;1.2.840.113619.2.55.1.1762895154.2356.1113547738.909.48;1.2.840.113619.2.55.1.1762895154.2356.1113547738.910.49;1.2.840.113619.2.55.1.1762895154.2356.1113547738.911.50;1.2.840.113619.2.55.1.1762895154.2356.1113547738.912.51;1.2.840.113619.2.55.1.1762895154.2356.1113547738.913.52;1.2.840.113619.2.55.1.1762895154.2356.1113547738.914.53;1.2.840.113619.2.55.1.1762895154.2356.1113547738.915.54;1.2.840.113619.2.55.1.1762895154.2356.1113547738.916.55;1.2.840.113619.2.55.1.1762895154.2356.1113547738.917.56;1.2.840.113619.2.55.1.1762895154.2356.1113547738.918.57;1.2.840.113619.2.55.1.1762895154.2356.1113547738.919.58;1.2.840.113619.2.55.1.1762895154.2356.1113547738.920.59;1.2.840.113619.2.55.1.1762895154.2356.1113547738.921.60;1.2.840.113619.2.55.1.1762895154.2356.1113547738.922.61;1.2.840.113619.2.55.1.1762895154.2356.1113547738.923.62;1.2.840.113619.2.55.1.1762895154.2356.1113547738.924.63;1.2.840.113619.2.55.1.1762895154.2356.1113547738.925.64;1.2.840.113619.2.55.1.1762895154.2356.1113547738.926.65;1.2.840.113619.2.55.1.1762895154.2356.1113547738.927.66;1.2.840.113619.2.55.1.1762895154.2356.1113547738.928.67;1.2.840.113619.2.55.1.1762895154.2356.1113547738.929.68;1.2.840.113619.2.55.1.1762895154.2356.1113547738.930.69;1.2.840.113619.2.55.1.1762895154.2356.1113547738.931.70;1.2.840.113619.2.55.1.1762895154.2356.1113547738.932.71;1.2.840.113619.2.55.1.1762895154.2356.1113547738.933.72;1.2.840.113619.2.55.1.1762895154.2356.1113547738.934.73;1.2.840.113619.2.55.1.1762895154.2356.1113547738.935.74;1.2.840.113619.2.55.1.1762895154.2356.1113547738.936.75;1.2.840.113619.2.55.1.1762895154.2356.1113547738.937.76;1.2.840.113619.2.55.1.1762895154.2356.1113547738.938.77;1.2.840.113619.2.55.1.1762895154.2356.1113547738.939.78;1.2.840.113619.2.55.1.1762895154.2356.1113547738.940.79;1.2.840.113619.2.55.1.1762895154.2356.1113547738.941.80;1.2.840.113619.2.55.1.1762895154.2356.1113547738.942.81;1.2.840.113619.2.55.1.1762895154.2356.1113547738.943.82;1.2.840.113619.2.55.1.1762895154.2356.1113547738.944.83;1.2.840.113619.2.55.1.1762895154.2356.1113547738.945.84;1.2.840.113619.2.55.1.1762895154.2356.1113547738.946.85;1.2.840.113619.2.55.1.1762895154.2356.1113547738.947.86;1.2.840.113619.2.55.1.1762895154.2356.1113547738.948.87;1.2.840.113619.2.55.1.1762895154.2356.1113547738.949.88;1.2.840.113619.2.55.1.1762895154.2356.1113547738.950.89;1.2.840.113619.2.55.1.1762895154.2356.1113547738.951.90;1.2.840.113619.2.55.1.1762895154.2356.1113547738.952.91;1.2.840.113619.2.55.1.1762895154.2356.1113547738.953.92;1.2.840.113619.2.55.1.1762895154.2356.1113547738.954.93;1.2.840.113619.2.55.1.1762895154.2356.1113547738.955.94;1.2.840.113619.2.55.1.1762895154.2356.1113547738.956.95;1.2.840.113619.2.55.1.1762895154.2356.1113547738.957.96;1.2.840.113619.2.55.1.1762895154.2356.1113547738.958.97;1.2.840.113619.2.55.1.1762895154.2356.1113547738.959.98;1.2.840.113619.2.55.1.1762895154.2356.1113547738.960.99;1.2.840.113619.2.55.1.1762895154.2356.1113547738.961.100;1.2.840.113619.2.55.1.1762895154.2356.1113547738.962.101;1.2.840.113619.2.55.1.1762895154.2356.1113547738.963.102;1.2.840.113619.2.55.1.1762895154.2356.1113547738.964.103;1.2.840.113619.2.55.1.1762895154.2356.1113547738.965.104;1.2.840.113619.2.55.1.1762895154.2356.1113547738.966.105;1.2.840.113619.2.55.1.1762895154.2356.1113547738.967.106;1.2.840.113619.2.55.1.1762895154.2356.1113547738.968.107;1.2.840.113619.2.55.1.1762895154.2356.1113547738.969.108;1.2.840.113619.2.55.1.1762895154.2356.1113547738.970.109;1.2.840.113619.2.55.1.1762895154.2356.1113547738.971.110;1.2.840.113619.2.55.1.1762895154.2356.1113547738.972.111;1.2.840.113619.2.55.1.1762895154.2356.1113547738.973.112;1.2.840.113619.2.55.1.1762895154.2356.1113547738.974.113;1.2.840.113619.2.55.1.1762895154.2356.1113547738.975.114" SEQUENCE4="Seq. Nr. 2;1.2.840.113619.2.55.1.1762895154.2356.1113547738.981.1;1.2.840.113619.2.55.1.1762895154.2356.1113547738.982.2;1.2.840.113619.2.55.1.1762895154.2356.1113547738.983.3;1.2.840.113619.2.55.1.1762895154.2356.1113547738.984.4;1.2.840.113619.2.55.1.1762895154.2356.1113547738.985.5;1.2.840.113619.2.55.1.1762895154.2356.1113547738.986.6;1.2.840.113619.2.55.1.1762895154.2356.1113547738.987.7;1.2.840.113619.2.55.1.1762895154.2356.1113547738.988.8;1.2.840.113619.2.55.1.1762895154.2356.1113547738.989.9;1.2.840.113619.2.55.1.1762895154.2356.1113547738.990.10;1.2.840.113619.2.55.1.1762895154.2356.1113547738.991.11;1.2.840.113619.2.55.1.1762895154.2356.1113547738.992.12;1.2.840.113619.2.55.1.1762895154.2356.1113547738.993.13;1.2.840.113619.2.55.1.1762895154.2356.1113547738.994.14;1.2.840.113619.2.55.1.1762895154.2356.1113547738.995.15;1.2.840.113619.2.55.1.1762895154.2356.1113547738.996.16;1.2.840.113619.2.55.1.1762895154.2356.1113547738.997.17;1.2.840.113619.2.55.1.1762895154.2356.1113547738.998.18;1.2.840.113619.2.55.1.1762895154.2356.1113547738.999.19;1.2.840.113619.2.55.1.1762895154.2356.1113547739.0.20;1.2.840.113619.2.55.1.1762895154.2356.1113547739.1.21;1.2.840.113619.2.55.1.1762895154.2356.1113547739.2.22;1.2.840.113619.2.55.1.1762895154.2356.1113547739.3.23;1.2.840.113619.2.55.1.1762895154.2356.1113547739.4.24;1.2.840.113619.2.55.1.1762895154.2356.1113547739.5.25;1.2.840.113619.2.55.1.1762895154.2356.1113547739.6.26;1.2.840.113619.2.55.1.1762895154.2356.1113547739.7.27;1.2.840.113619.2.55.1.1762895154.2356.1113547739.8.28;1.2.840.113619.2.55.1.1762895154.2356.1113547739.9.29;1.2.840.113619.2.55.1.1762895154.2356.1113547739.10.30;1.2.840.113619.2.55.1.1762895154.2356.1113547739.11.31;1.2.840.113619.2.55.1.1762895154.2356.1113547739.12.32;1.2.840.113619.2.55.1.1762895154.2356.1113547739.13.33;1.2.840.113619.2.55.1.1762895154.2356.1113547739.14.34;1.2.840.113619.2.55.1.1762895154.2356.1113547739.15.35;1.2.840.113619.2.55.1.1762895154.2356.1113547739.16.36;1.2.840.113619.2.55.1.1762895154.2356.1113547739.17.37;1.2.840.113619.2.55.1.1762895154.2356.1113547739.18.38;1.2.840.113619.2.55.1.1762895154.2356.1113547739.19.39;1.2.840.113619.2.55.1.1762895154.2356.1113547739.20.40" IMAGE_SERVLET="/WebViewer/servlet/GetImageServlet?IMGUID="  \
	    			scriptable=false \
	    			pluginspage="http://java.sun.com/products/plugin/index.html#download"&gt;');
		else
			document.writeln('&lt;APPLET  CODE = "com.tiani.jvision.applet.DisplayApplet.class" \
				ARCHIVE = "../WebViewer/jvapplet.jar" \
				WIDTH = '+ W +'\
				HEIGHT = '+ H + '&gt; \
		                       &lt;PARAM NAME = "CODE" VALUE = "com.tiani.jvision.applet.DisplayApplet.class" /&gt; \
		    	        &lt;PARAM NAME = "ARCHIVE" VALUE = "../WebViewer/jvapplet.jar" /&gt; \
			        &lt;PARAM NAME = "DB_FIRST_NAME" VALUE="KLAUS-DIETER" /&gt; \
			        &lt;PARAM NAME ="DB_LAST_NAME" VALUE ="UNRATH"/&gt; \
			        &lt;PARAM NAME ="DB_SEX" VALUE ="M" /&gt; \
			        &lt;PARAM NAME ="DB_BIRTH_DATE" VALUE ="19390503" /&gt; \
			        &lt;PARAM NAME = "SELECT_SEQUENCE" VALUE="1" /&gt; \
			            &lt;PARAM NAME ="SEQUENCE1" VALUE ="Seq. Nr. 1;1.2.840.113619.2.55.1.1762895154.2356.1113547738.859.1;1.2.840.113619.2.55.1.1762895154.2356.1113547738.860.2" /&gt; \
			            &lt;PARAM NAME = "SEQUENCE2" VALUE ="Seq. Nr. 1;1.2.840.113619.2.55.1.1762895154.2356.1113547738.978.1;1.2.840.113619.2.55.1.1762895154.2356.1113547738.979.2" /&gt; \
			            &lt;PARAM NAME = "SEQUENCE3" VALUE ="Seq. Nr. 2;1.2.840.113619.2.55.1.1762895154.2356.1113547738.862.1;1.2.840.113619.2.55.1.1762895154.2356.1113547738.863.2;1.2.840.113619.2.55.1.1762895154.2356.1113547738.864.3;" /&gt; \
    		                        &lt;PARAM NAME = "IMAGE_SERVLET" VALUE ="/WebViewer/servlet/GetImageServlet?IMGUID=" /&gt;  \
    			        &lt;PARAM NAME="type" VALUE="application/x-java-applet;version=1.4" /&gt; \
    			        &lt;PARAM NAME="scriptable" VALUE="false" /&gt; \
				&lt;/APPLET&gt;');
	//--&gt;</xsl:text></script>
	

 
	<!--"END_CONVERTED_APPLET"-->

</body>
</html>
	    
</xsl:template>
    
<xsl:template name="firstName">
    <xsl:variable name="pat"><xsl:value-of select="patient/patientName"/></xsl:variable>
    <xsl:choose>
        <xsl:when test="contains($pat,'^')">
             <xsl:value-of select="substring-after($pat,'^')"/>
        </xsl:when>
    </xsl:choose>
</xsl:template>

<xsl:template name="lastName">
    <xsl:variable name="pat"><xsl:value-of select="patient/patientName"/></xsl:variable>
    <xsl:choose>
        <xsl:when test="contains($pat,'^')">
             <xsl:value-of select="substring-before($pat,'^')"/>
        </xsl:when>
        <xsl:otherwise>
            <xsl:value-of select="$pat"/>    
        </xsl:otherwise>
    </xsl:choose>
</xsl:template>
    
<xsl:template match="item[@type='org.dcm4chex.archive.web.maverick.StudyViewCtrl$SeriesContainer']">
    <xsl:if test="modality != 'SR' and modality != 'KO' ">
        <PARAM>
            <xsl:attribute name="NAME"><xsl:text>SEQUENCE</xsl:text><xsl:value-of select="position()"/></xsl:attribute>
            <xsl:attribute name="VALUE">
                <xsl:text>Seq. Nr. </xsl:text><xsl:value-of select="seriesNumber"/>
                <xsl:apply-templates select="instanceUIDs/item"></xsl:apply-templates>
            </xsl:attribute>
        </PARAM><xsl:text>\
                                                                                            </xsl:text>
        </xsl:if>
</xsl:template>
    
<xsl:template match="item[@type='java.lang.String']">
	<xsl:text>;</xsl:text><xsl:value-of select="." />
</xsl:template>

</xsl:stylesheet>

