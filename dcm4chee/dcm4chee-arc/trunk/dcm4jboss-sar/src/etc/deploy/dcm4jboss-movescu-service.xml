<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE server>
<!-- $Id$ -->

<!-- ===================================================================== -->
<!--                                                                       -->
<!--  DICOM Storage Service Configuration                                   -->
<!--                                                                       -->
<!-- ===================================================================== -->

<server>

<classpath codebase="lib" archives="dcm4jboss.jar"/>

  <mbean code="org.dcm4chex.service.MoveScuService" 
	name="dcm4chex:service=MoveScu,aet=MOVE_SCU">

    <!-- Do NOT uncomment this line if the service is deployed
    in the same jboss instance as the MoveQueue EJB. Otherwise
    in VM calls to go over RMI!
        
    <attribute name="EjbProviderURL">jnp://localhost:1099</attribute>
    -->

    <!-- 
    Specifies JNDI name used to look up the datasource.
    Name after "java:/" must match with <jndi-name> attribute of 
    JDBC Datasource configuration deployment file (*-ds.xml) 
	-->
    <attribute name="DataSource">java:/PostgresDS</attribute>    

    <!-- 
    Specifies number of intervalls of retries of failed Move Requests.
    Number of comma separated intervall time entries defines number of 
    retries.  Time values can be specified in milliseconds (##), seconds (##s),
    minutes (##m), hours (##h) and days (##d);
	-->
    <attribute name="RetryIntervalls">1m,10m,1h,6h,1d</attribute>    

    <!-- 
    Specifies maximal number of concurrently invoked move requests.
	-->
    <attribute name="MaxConcurrentMoves">1</attribute>
  </mbean>

  <mbean code="org.jboss.varia.scheduler.Scheduler" 
	 name="dcm4chex:service=Scheduler,name=Scheduler of MoveScu">

    <!-- To avoid NameNotBoundExceptions during server startup. MUST be
	removed, if the service is NOT deployed in the same jboss instance
	as the MoveOrderQueue EJB!
	-->
    <depends>jboss.j2ee:jndiName=ejb/MoveOrderQueue,service=EJB</depends>
        
    <!-- 
    Value must match with name attribute of MoveScuService mbean (s.above)!
	-->
    <attribute name="SchedulableMBean">dcm4chex:service=MoveScu,aet=MOVE_SCU</attribute>

    <!-- 
    Specifies intervall in milliseconds for polling for new Move Orders in DB.
	-->
    <attribute name="SchedulePeriod">60000</attribute>

    <attribute name="StartAtStartup">true</attribute>
    <attribute name="SchedulableMBeanMethod">run</attribute>
    <attribute name="InitialStartDate">NOW</attribute>
    <attribute name="InitialRepetitions">-1</attribute>
  </mbean>

</server>

