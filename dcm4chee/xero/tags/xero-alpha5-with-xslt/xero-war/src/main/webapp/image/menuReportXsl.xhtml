<x:xsl
  pageConfig="#{(pageConfig!=null ? pageConfig : metadata.image.imageXsl).menuReportXsl}"
  xmlns:x="http://www.dcm4che.org/xero/jsf"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:m="http://www.dcm4che.org/xero/metadata/image/imageXsl/menuReportXsl"
  xmlns:c="http://java.sun.com/jstl/core"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:h="http://www.w3.org/1999/xhtml"
  m:includeXsl="/image/menuReportXsl.xhtml"
>

<!-- Iterate over all GSPS nodes with distinct names. -->
<x:template name="reportLayout" mode="newlayout" match="se:report">
 <xsl:param name="loc" />
 <xsl:param name="node" select="/.."/>
 <xsl:param name="custNode" select="/.." />
 <xsl:variable name="children" select="./*" />
 <xsl:for-each select="$node/se:series/se:report">
   <xsl:variable name="name" select="@conceptMeaning" />
   <xsl:variable name="curSOP" select="@SOPInstanceUID" />
   <xsl:variable name="firstSOP" select="($node/se:series/se:report[@conceptMeaning=$name]/@SOPInstanceUID)[1]" />
   <xsl:if test="$firstSOP = $curSOP" >
     <xsl:apply-templates mode="newlayout" select="$children">
       <xsl:with-param name="loc" />
       <xsl:with-param name="node" select="." />
       <xsl:with-param name="custNode" select="$custNode" />
     </xsl:apply-templates>
   </xsl:if>
 </xsl:for-each>
</x:template>

<x:template name="reportLabel" mode="newlayout" match="h:span[@class='reportLabel']">
  <xsl:param name="node" select="/.."/>
  <xsl:message>Report <xsl:value-of select="$node/@conceptMeaning" /></xsl:message>
  <xsl:value-of select="$node/@conceptMeaning" />
</x:template>

<x:template name="reportHrefArgs" mode="hrefArgsNode" match="se:report"><xsl:apply-templates select=".." mode="hrefArgsNode" />&amp;objectUID=<xsl:value-of select="@SOPInstanceUID" /></x:template>

</x:xsl>