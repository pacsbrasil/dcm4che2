<html>
<head><title>Xero Internal Model Overview</title></head>
<body>
<h1>Xero Internal Model Overview</h1>
<p>The Xero internal model defines the structures and information used to render the view.  This may include
representations of external model data structures that are re-used internally - however, it is not expected
that many external representations will be directly used, at a minimum the query parameters to get the
external information is required.</p>




Internal model - consists of:
	Request parameter definitions - defines how to take request parameters, validate them and then use them in 
	the model.  This maybe as simple as embedding them in another query, or it can be as complex as updating
	some sub-tree portion of the overall model.
	
External, Session, Event and Conversational Model
	Different parts of the model can be defined at different stages.  Event data is refreshed on every request
	and is unique to the request.  Session data is the same for all display windows, while conversational data
	is unique to a given frame/window - different browser windows or frames can be in different conversations.
	The external data is considered to be global for all users, and depends only on the query used to retrieve it.
	(it can be read directly if required for performance to avoid the XML generate/parse loop, assuming server
	side rendering.)
	
There are a number of data models of interest - in general, they should be defined in separate files and have a 
way to be used in both Java and JavaScript so that they can be defined/used either server or client side.

	Display Mode - conversational - contains a hierarchy of information about how the display is organized - this is a parent
		structure for everything that is displayed.  Thus, it is perfectly possible to have multiple query models
		or study displays. 
		 
	Query Model - conversational - contains information about what query was performed and what the results are.
		Query Parameters
		Search Results - external model component.
	
	Patient Display - contains a single patient being displayed, and the various modes applied to the patient
	display
		Studies - contains list of studies to display.
		Layout - contains information about how to organize the display layout - needs an XML format and custom updaters
			presentation state (externally combined data) - GSPS info to include
			rows/boxes - contains rows of boxes that have the actual render information.
				boxType  (series tray, series control, image box etc)
				display modes (set of boolean flags to indicate various modes)
				image - contains image (object) to display
				series - contains series to display, based on type
				imagePosition - contains information on the image position for a series
	
Both image and series level objects contain a local change and an original value/source, where the image level
only contains some values when at least 1 value differs from the original.  This is a fully-nested structure
created dynamically.

The display layout is an extended structure, not all of which maybe immediately available to the client to render
- some information might be only available based on the selected patient, in specific, information about
other patients is not generally available, only the current patient information is available.

The internal model needs to be renderable and parseable within JavaScript so as to allow passing it from the
server to the client (WHY do this as long as the information is maintained client or server side - probably
allow passing of series/image updates, but not anything else.)

The model does need the ability to create a JavaScript file that defines how the model is itself used, and that
should be relatively static, no more than 1 version for each browser/language/theme group.  
This model can be defined by JS snippets and/or included entire JS files as required.

The model should have unit tests that run both client and server side.  Basically the same set of tests should
also be runnable from the client side passing any passable data through to the server side.

The JS version should have the ability to add event listeners to specific attributes.

The controller defines what to submit/change on a given submission - it interacts with the data model to update
it, as well as to add bits of information that include URLs for various actions.  The generated JS for the model
needs to include the JS version of the controller, even though they are defined in separate files/locations. 

</body>
</html>  	