<?xml version="1.0" encoding="UTF-8"?>
<x:xsl
   pageConfig="#{PageConfig.series}"
   xmlns:x="http://www.dcm4che.org/xero/jsf"
   xmlns:ui="http://java.sun.com/jsf/facelets"
   xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
   xmlns:m="http://www.dcm4che.org/xero/metadata/series"
   m:xsl="seriesTrayXsl.xsl"
   m:docName="/documents/series"
   m:jsEnabled.inherit="jsEnabled"
   m:Event.script="../js/Events.js"   m:Event.script.priority="1000"
>

<xsl:variable name="docName" select="/documents/series"/>
<ui:include src="seriesVars.xhtml" />

<!-- Display the series tray debugging information -->
<x:template name="seriesTrayDebug" m:debug.body="seriesTrayDebug" m:debug.body.priority="1000">
    <xsl:if test="/documents/debug='true'">
       docName=<xsl:value-of select="$docName"/> <br />
       #children patientNode=<xsl:value-of select="count($patientNode)" /><br />
       #children studyNode=<xsl:value-of select="count($studyNode)" /><br />
       studyUID=<xsl:value-of select="$studyUID" /><br />
       seriesUID=<xsl:value-of select="$seriesUID" /><br />
       @conversationId=<xsl:value-of select="/documents/@conversationId" /><br />
       cid=<xsl:value-of select="$cid" /><br />
    </xsl:if>
</x:template>

<!-- Display the series tray header information -->
<x:template name="seriesTrayHeader" m:header.body="seriesTrayHeader" m:header.body.priority="950" >
    <xsl:value-of select="$docNode/se:results/se:patient/@PatientName" /> <br />
    <xsl:value-of select="$docNode/se:results/se:patient/@PatientID" /> <br />
    <xsl:value-of select="$docNode/se:results/se:patient/se:study/@StudyDescription" /> <br />
</x:template>

<!-- Display the series images -->
<x:template name="seriesImages" m:images.body="seriesImages" m:images.body.priority="500">
    <xsl:for-each select="$docNode/se:results/se:patient/se:study/se:series[se:image/@Rows>0]">
      <xsl:sort select="@SeriesNumber" />
      <span xml:space="preserve"><xsl:value-of select="@SeriesNumber" />
        <xsl:value-of select="@SeriesDescription" />
        <xsl:value-of select="@NumberOfSeriesRelatedInstances" />
     </span>
      <center>
         <a target="imageFrame">
           <xsl:attribute name="href">../image/image.seam?cid=<xsl:value-of select="$cid"/>&amp;studyUID=<xsl:value-of select="se:image/ancestor-or-self::*[@StudyInstanceUID]/@StudyInstanceUID" />&amp;seriesUID=<xsl:value-of select="se:image/ancestor-or-self::*[@SeriesInstanceUID]/@SeriesInstanceUID" /></xsl:attribute>
           <img>
            <xsl:attribute name="src">/xero/wlwado?requestType=WADO&amp;studyUID=<xsl:value-of select="se:image/ancestor-or-self::*[@StudyInstanceUID]/@StudyInstanceUID" />&amp;seriesUID=<xsl:value-of select="se:image/ancestor-or-self::*[@SeriesInstanceUID]/@SeriesInstanceUID" />&amp;objectUID=<xsl:value-of select="se:image/@SOPInstanceUID"/>&amp;rows=128</xsl:attribute>
           </img>
         </a>
      </center>
    </xsl:for-each>
</x:template>

<!-- Display the html page for the series tray -->
<x:template name="seriesTrayHtml" match="/" >
<html xmlns="http://www.w3.org/1999/xhtml">
<head>    
    <x:callTemplates from="#{pageConfig}" mode="meta" />
    <title>Xero Series Tray</title>
    <x:callTemplates from="#{pageConfig}" mode="script" />
</head>
<body style="background: black; color: white; ">
  <div id="body">
    <x:callTemplates from="#{pageConfig}" mode="body" />
  </div>
</body>
</html>
</x:template>

</x:xsl>

