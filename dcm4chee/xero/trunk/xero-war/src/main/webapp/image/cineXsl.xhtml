<x:xsl
  pageConfig="#{PageConfig.display.cine}"
  xmlns:x="http://www.dcm4che.org/xero/jsf"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:m="http://www.dcm4che.org/xero/metadata/display/cine"
  m:toolbar="cineIcon"
  m:toolbar.priority="15"
  m:includeXsl="/image/cineXsl.xhtml"
  m:includeXsl.priority="-25"
  m:meta="cineMeta"
  m:body="imagePrefetch"
>
<!-- 
	 The CINE XSL stylesheet defines the options required for adding CINE playback
     and controls to the images.
-->

<!-- Generate the cine meta-data information as appropriate -->
<xsl:template name="cineMeta">
    <xsl:if test="/documents/cine!='' and $imageNextUID!=''">
      <meta>
        <xsl:attribute name="http-equiv">refresh</xsl:attribute>
        <xsl:attribute name="content"><xsl:value-of select="/documents/cine" />; URL=image.seam?cid=<xsl:value-of select="$cid" />&amp;studyUID=<xsl:value-of select="$studyUID"/>&amp;seriesUID=<xsl:value-of select="$seriesUID"/>&amp;objectUID=<xsl:value-of select="$imageNextUID" />&amp;cine=<xsl:value-of select="/documents/cine" /></xsl:attribute>
      </meta>
    </xsl:if>
</xsl:template>

<!-- Display the CINE label/icon, only if there is a next image-->
<xsl:template name="cineIcon">
    <xsl:if test="$imageNextUID!=''">
       <xsl:if test="/documents/cine!=''">
         <a>
           <xsl:attribute name="href">image.seam?cid=<xsl:value-of select="$cid" />&amp;studyUID=<xsl:value-of select="$studyUID"/>&amp;seriesUID=<xsl:value-of select="$seriesUID"/>&amp;position=<xsl:value-of select="$imagePosition" /></xsl:attribute>
           CINE Off
         </a>
       </xsl:if>
       <xsl:if test="/documents/cine=''">
         <a>
           <xsl:attribute name="href">image.seam?cid=<xsl:value-of select="$cid" />&amp;studyUID=<xsl:value-of select="$studyUID"/>&amp;seriesUID=<xsl:value-of select="$seriesUID"/>&amp;position=<xsl:value-of select="1+$imagePosition" />&amp;cine=0.5</xsl:attribute>           
         CINE
         </a>
       </xsl:if>
    </xsl:if>
</xsl:template>

<xsl:template name="imagePrefetch">
    <div style="display:none; " id="imagePrefetch">
    <xsl:if test="$imageNextUID!=''">
      <img>
        <xsl:attribute name="src">/xero/wlwado?requestType=WADO&amp;studyUID=<xsl:value-of select="$imageNode/ancestor-or-self::*[@StudyInstanceUID]/@StudyInstanceUID" />&amp;seriesUID=<xsl:value-of select="$imageNode/ancestor-or-self::*[@SeriesInstanceUID]/@SeriesInstanceUID" />&amp;objectUID=<xsl:value-of select="$imageNextUID"/>&amp;rows=512</xsl:attribute>
      </img>
    </xsl:if>
    <xsl:if test="$imagePrevUID!=''">
      <img>
        <xsl:attribute name="src">/xero/wlwado?requestType=WADO&amp;studyUID=<xsl:value-of select="$imageNode/ancestor-or-self::*[@StudyInstanceUID]/@StudyInstanceUID" />&amp;seriesUID=<xsl:value-of select="$imageNode/ancestor-or-self::*[@SeriesInstanceUID]/@SeriesInstanceUID" />&amp;objectUID=<xsl:value-of select="$imagePrevUID"/>&amp;rows=512</xsl:attribute>
      </img>
    </xsl:if>
   </div>
</xsl:template>

</x:xsl>
