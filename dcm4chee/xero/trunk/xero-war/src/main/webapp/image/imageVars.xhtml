<ui:component xmlns:ui="http://java.sun.com/jsf/facelets" 
   xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
   xmlns:m="http://www.dcm4che.org/xero/metadata/display/vars"
   m:includeXsl="/image/imageVars.xhtml"
   m:includeXsl.priority="-10"
>
<xsl:variable name="docName" select="#{pageConfig.docName}" />
<ui:include src="/series/seriesVars.xhtml" />

<xsl:variable name="imagePosition"><xsl:value-of select="number(/documents/position)"/></xsl:variable>
<xsl:variable name="seriesViewable" select="number($docNode/se:results/se:patient/se:study/se:series/@Viewable)"/>
<xsl:variable name="imageUID">
<xsl:value-of select="$studyNode/se:series/se:image[@Position=$imagePosition]/@SOPInstanceUID"/>
</xsl:variable>

<xsl:variable name="imageNode" select="$docNode/se:results/se:patient/se:study/se:series/se:image[@SOPInstanceUID=$imageUID]" />
<xsl:variable name="imagePrevUID" select="$imageNode/preceding::se:image[1]/@SOPInstanceUID" />
<xsl:variable name="imageNextUID" select="$imageNode/following::se:image/@SOPInstanceUID" />

<xsl:variable name="frameNode" select="document(/documents/layout)/se:results" />
<xsl:variable name="windowWidth" select="/documents/windowLevel/@width" />
<xsl:variable name="windowCenter" select="/documents/windowLevel/@center" />
<xsl:variable name="region" select="/documents/region" />
<xsl:variable name="mode" select="/documents/mode" />
<xsl:variable name="documentsNode" select="/documents" />
<xsl:variable name="toolbarNode" select="document(/documents/toolbar)/*" />
</ui:component>