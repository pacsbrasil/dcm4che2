<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD Simplified DocBook XML V1.0//EN"
"http://www.oasis-open.org/docbook/xml/simple/1.0/sdocbook.dtd">
<article>
  <articleinfo>
    <title>jPrint 1.2 User&#39;s Guide</title>

    <corpauthor>Tiani Medgraph AG, <ulink url="http://www.tiani.com">http://www.tiani.com</ulink></corpauthor>

    <pubdate>10 June 2003</pubdate>
  </articleinfo>

  <section>
    <title>Introduction</title>

    <para>This document describes how to install, configure and calibrate
    TIANI&#39;s DICOM Print Server jPrint 1.2 for proper mode of operation.</para>

    <para>jPrint 1.2 is delivered pre-configured, to enable to run with
    minimal adjustments of the default configuration according to your
    printing environment.</para>

    <para>To achieve hard copy presentation quality and consistency compliant
    to the <emphasis>DICOM Part 14: Grayscale Standard Display Function</emphasis>,
    jPrint 1.2 has to quantify the characteristic curve of connected printers.
    This procedure is called <link linkend="printer-calibration">Printer
    Calibration</link>, and shall be repeated at regular intervals, but
    particularly after any printer adjustment (e.g. toner refill).</para>

    <para>jPrint 1.2 also supports the configuration of modality-specific
    Presentation LUTs, for the common case, that the Print Composer
    implementation of the modality (or workstation) does not provide an
    appropriate Presentation LUT by itself.</para>

    <para>Also different annotation formats can be configured and associated
    to Print Jobs from a particular Print SCU.</para>
  </section>

  <section>
    <title>Installation</title>

    <section>
      <title>Requirements</title>

      <itemizedlist>
        <listitem>
          <para><ulink url="http://java.sun.com/j2se/">Sun Java[tm] </ulink>2
          runtime 1.4.0_01 or above. J2SE SDK recommended: required for use of
          &#34;server&#34; VM and for running jPrint with embedded Audit
          Record Repository (jAudit 0.1).</para>
        </listitem>

        <listitem>
          <para>At least 128Mb of memory and a 400MHz CPU.</para>
        </listitem>

        <listitem>
          <para>100Mb free disk space - mainly for spooled print jobs (jPrint
          1.2 program files require less than 10Mb of disk space); if the
          performance of the connected printer is not sufficient to forward
          incoming print jobs immediately, much more (&#62;1 Gb) disk space
          may be required, to enable jPrint to buffer print jobs as long the
          connected printer is not ready to accept them.</para>
        </listitem>

        <listitem>
          <para>Network card.</para>
        </listitem>

        <listitem>
          <para>Reference sheet with test pattern required for Printer
          Calibration using scanned print outs. - You will receive a reference
          sheet via postal service when you order the (evaluation) license of
          jPrint at <ulink url="http://www.tiani.com/products/jprint/">http://www.tiani.com/products/jprint/</ulink>.</para>
        </listitem>

        <listitem>
          <para>Scanner to scan reference sheet and printed test patterns for
          Printer Calibration.</para>
        </listitem>

        <listitem>
          <para>Gray Scale Densitometer as alternative to the Printer
          Calibration using a scanner and for the quantitative QA of Printer
          Calibration.</para>
        </listitem>
      </itemizedlist>

      <para>jPrint has been tested with Sun Java 2 SDK SE 1.4.1_01 under
      Windows XP and GNU/Linux Debian Woody 2.4.18-686.</para>
    </section>

    <section>
      <title>Quick Start with default configuration</title>

      <orderedlist>
        <listitem>
          <para>Before installing and running the server, you should check
          that your JDK 1.4.x installation is working. The simplest way to do
          this is to execute the <command>java -version</command> command to
          ensure that the <command>java</command> executable is in your path,
          and that you are using version 1.4:</para>

          <programlisting>$ java -version
java version &#34;1.4.1_01&#34;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.4.1_01-b01)
Java HotSpot(TM) Client VM (build 1.4.1_01-b01, mixed mode)</programlisting>

          <para>You should also ensure that the environment variable JAVA_HOME
          is set to the path of the JDK installation directory. E.g. on UNIX
          systems by:</para>

          <programlisting>$ echo $JAVA_HOME
/usr/local/java/j2sdk1.4.1_01</programlisting>

          <para>and on Windows systems by:</para>

          <programlisting>$ echo %JAVA_HOME%
C:\j2sdk1.4.1_01</programlisting>
        </listitem>

        <listitem>
          <para>Download the latest version of jPrint from <ulink
          url="http://www.tiani.com/products/jprint/">http://www.tiani.com/products/jprint/</ulink>.</para>

          <para>jPrint is distributed in two different formats:</para>

          <variablelist>
            <varlistentry>
              <term><filename>jprint-1.2.x.zip</filename></term>

              <listitem>
                <para>Contains jPrint DICOM print server + utilities, bundled
                with a stripped-down JBoss application server distribution (s.
                <ulink url="http://www.jboss.org">http://www.jboss.org</ulink>)
                , to run out of the box.</para>
              </listitem>
            </varlistentry>

            <varlistentry>
              <term><filename>jprint-with-jaudit-1.2.x.zip</filename></term>

              <listitem>
                <para>Additionally contains jAudit as Audit Record Repository
                to store audit records generated by jPrint in a database for
                audit purposes (also included).</para>
              </listitem>
            </varlistentry>
          </variablelist>
        </listitem>

        <listitem>
          <para>Unpack the jPrint distribution somewhere, using any ZIP
          extractor or the <command>jar</command> tool included in the Java 2
          SDK:</para>

          <programlisting>$ jar xvf jprint-1.2.x.zip</programlisting>
        </listitem>

        <listitem>
          <para>Copy your license file <filename>license.jks</filename> into
          the <filename>server/default/conf/</filename> directory of the
          distribution.</para>

          <note>
            <para>You may order a free evaluation license for jPrint 1.2 using
            the form at <ulink url="http://www.tiani.com/products/jprint/">http://www.tiani.com/products/jprint/</ulink>
            .</para>
          </note>
        </listitem>

        <listitem>
          <para>Open a console and change your working directory to the
          <filename>bin/</filename> directory of the distribution:</para>

          <programlisting>$ cd jprint-1.2.1/bin</programlisting>
        </listitem>

        <listitem>
          <para>Check if your license is valid for running jPrint 1.2 on this
          host by utility <link linkend="check-license.jar"><command>check-license.jar</command></link>:</para>

          <programlisting>$ java -jar check-license.jar ../server/default/conf/license.jks

=== License #1 ===

Subject: CN=Gunter Zeilinger, OU=Development, O=Tiani Medgraph AG, L=Brunn am Gebirge, ...
Issuer: CN=Tiani License CA, OU=Development, O=Tiani Medgraph AG, L=Brunn am Gebirge, ...
Validity        ok
        Not Before: Sat Apr 12 23:55:42 CEST 2003
        Not After:  Fri Apr 07 23:55:42 CEST 2023
Host Identification:
        IP:  212.186.124.39     match
        MAC: 00:50:04:3F:83:0F  match
        DNS: gunter.tiani.org   match
Product(s):
        1.2.40.0.13.2.1.1.2/jPrint-1.2
        1.2.40.0.13.2.2.0.1/jAudit-0.1</programlisting>
        </listitem>

        <listitem>
          <para>Determine printer names of installed system and network
          printers by utility <link linkend="list-printers.jar"><command>list-printers.jar</command></link>:</para>

          <programlisting>$ java -jar list-printers.jar
Available Printers:
MINOLTA
psc750gimp
psc750hpijs</programlisting>
        </listitem>

        <listitem>
          <para>Open the configuration file <filename>server/default/deploy/printer-service.xml</filename>
          with any text editor, which treats ASCII files with a single
          linefeed as line delimiter (UNIX style) properly.
          <command>NotePad</command> on Microsoft Windows fails to do that,
          but you may use <command>WordPad,</command> which displays UNIX line
          formated text files correctly. Replace <literal>myprinter.</literal></para>

          <programlisting>  &#60;!--
  Specifies name of the printer used by the system.
  --&#62;
  &#60;attribute name=&#34;PrinterName&#34;&#62;<emphasis role="bold"><replaceable>myprinter</replaceable></emphasis>&#60;/attribute&#62;</programlisting>

          <para>by the actual name of the connected printer to use. This must
          be one of <literal>Available Printers</literal> listed above.</para>
        </listitem>

        <listitem>
          <para>[optional] If you want to change the default Application
          Entity Title (AET), associated with the printer, you must also
          replace <literal>TIANI_PRINT</literal> in the same configuration
          file some lines above.</para>

          <programlisting>  &#60;mbean code=&#34;com.tiani.prnscp.print.PrinterService&#34; 
           name=&#34;dcm4chex:service=Printer,calledAET=<emphasis role="bold"><replaceable>TIANI_PRINT</replaceable></emphasis>&#34;&#62;</programlisting>
        </listitem>

        <listitem>
          <para>[optional] If you want to change the default port (6104),
          where the DICOM server shall be listening for incoming association
          requests from Print Clients, you have also to replace 6104 in the
          server configuration file <filename>server/default/deploy/printer-service.xml</filename>:</para>

          <programlisting>  &#60;!--
  Specifies TCP port on which the DICOM server is listening.
  --&#62;
  &#60;attribute name=&#34;Port&#34;&#62;<replaceable>6104</replaceable>&#60;/attribute&#62;</programlisting>

          <para>by the TCP port number to use.</para>
        </listitem>

        <listitem>
          <para>On UNIX you have to change the permission of the server launch
          script:</para>

          <programlisting>$ chmod a+x run.sh</programlisting>

          <para>before you can start the server by:</para>

          <programlisting>$ ./run.sh
================================================================================

  JBoss Bootstrap Environment

  JBOSS_HOME: /usr/local/jprint-1.2.1

  JAVA: /usr/local/java/j2sdk1.4.1_01/bin/java

  JAVA_OPTS: -Xms64m -Xmx100m -server -Dprogram.name=run.sh

  CLASSPATH: /usr/local/jprint-1.2.1/bin/run.jar:/usr/local/j2sdk1.4.1_01/lib/tools.jar

================================================================================

15:32:26,548 INFO  [Server] JBoss Release: JBoss-3.0.7 CVSTag=JBoss_3_0_7
:
15:32:41,590 INFO  [Server] JBoss (MX MicroKernel) [..] Started in 0m:14s:950ms</programlisting>

          <para>On WINDOWS you can start the server by entering:</para>

          <programlisting>$ run</programlisting>

          <para>If the license file you copied in step 4 into the
          <filename>server/default/conf/</filename> directory works, you will
          find the confirmation</para>

          <programlisting>15:32:41,383 INFO  [PrintScpService] Detect valid License for ...</programlisting>

          <para>in the console output - otherwise the warning:</para>

          <programlisting>15:32:41,383 WARN  [PrintScpService] No valid Licensedetected
                                     - shutdown server in 20 minutes!</programlisting>

          <para>You will get (2) warnings:</para>

          <programlisting>15:32:41,427 WARN  [PrinterService] Failed to calibrate Printer ...</programlisting>

          <para>because no preparation for <link linkend="printer-calibration">Printer
          Calibration</link> was done yet.</para>
        </listitem>

        <listitem>
          <para>Open another console and change the working directory (again)
          to the <filename>bin/</filename> directory of the jPrint
          distribution:</para>

          <programlisting>$ cd jprint-1.2.1/bin</programlisting>
        </listitem>

        <listitem>
          <para>Initiate the print-out of the DSI256 pattern used to determine
          the characteristic curve of the printer by utility <link
          linkend="print-image.jar"><command>print-image.jar</command></link>:</para>

          <programlisting>$ java -jar print-image.jar ../images/DSI256.dcm</programlisting>

          <para>For color printers, also print the DSI256 pattern in color
          mode:</para>

          <programlisting>$ java -jar print-image.jar -c ../images/DSI256.dcm</programlisting>
        </listitem>

        <listitem>
          <para>Scan the print-out(s), scan the reference sheet with<emphasis>
          equal scanning parameters</emphasis> and</para>

          <itemizedlist>
            <listitem>
              <para>store the scanned reference sheet as a JPEG file named
              <filename>DSI256.jpg</filename> into the <filename>server/default/conf/calibration</filename>
              directory,</para>
            </listitem>

            <listitem>
              <para>store the scanned DSI256 pattern print-out in monochrome
              mode (no -c option) into the <filename>TIANI_PRINT.monochrome</filename>
              sub-directory. Make sure the chosen file name ends with
              &#34;.jpg&#34; (<emphasis role="bold">not</emphasis>
              &#34;.jpeg&#34;),</para>
            </listitem>

            <listitem>
              <para>store the scanned DSI256 pattern print-out in color mode
              (with -c option) into the <filename>TIANI_PRINT.color</filename>
              sub-directory, again using a file name which ends with
              &#34;.jpg&#34;.</para>
            </listitem>
          </itemizedlist>
        </listitem>

        <listitem>
          <para>Initiate the calibrated print-out of the WEDGE8 pattern by:</para>

          <programlisting>$ java -jar print-image.jar -i shape=IDENTITY ../images/WEDGE8.dcm</programlisting>

          <para>and check the quality of the calibration visibly: The hard
          copy should not contain visible contours - the transition from dark
          to bright within the wedge should be smooth.</para>

          <para>You may also compare the result against the print-out of the
          same pattern without calibration by:</para>

          <programlisting>$ java -jar print-image.jar ../images/WEDGE8.dcm</programlisting>

          <para>For color printers, repeat the check for a calibrated
          print-out of the WEDGE8 pattern in color mode:</para>

          <programlisting>$ java -jar print-image.jar -c -i shape=IDENTITY ../images/WEDGE8.dcm</programlisting>
        </listitem>

        <listitem>
          <para>jPrint is now ready to accept DICOM associations on port 6104
          (or whatever the port configured, had it been changed in step 10).
          The Called AET associated with the connected printer is TIANI_PRINT
          (or the AET configured in step 9). Any Calling AET will be accepted
          in the default configuration.</para>
        </listitem>
      </orderedlist>
    </section>

    <section>
      <title>jPrint as Unix/Windows Startup Service</title>

      <para>It is recommended to test printing with a jPrint instance started
      manually from a console window as described above, so you can monitor
      proper function (or malfunction) by the logging output to the console
      window instantaneously , before running jPrint as Unix/Windows Startup
      Service. In which case you would always have to look into the generated
      log file located at <filename>server/default/log/server.log</filename>,
      to see what is going on/wrong.</para>

      <section>
        <title>Install jPrint as Unix Service</title>

        <para>You have to be super user to install a Unix Startup Service on
        the system.</para>

        <section>
          <title>Debian GNU/Linux</title>

          <orderedlist>
            <listitem>
              <para>Open <filename>bin/jprint_init_debian.sh</filename> in any
              ASCII editor and adjust the values of run-time parameters:</para>

              <variablelist>
                <varlistentry>
                  <term><literal>JAVA_HOME</literal></term>

                  <listitem>
                    <para>Location of JAVA 2 SDK installation directory.</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term><literal>JPRINT_HOME</literal></term>

                  <listitem>
                    <para>Location of jPrint installation directory.</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term><literal>JPRINT_USER</literal></term>

                  <listitem>
                    <para>specify the user under which jPrint will run on the
                    system. (Must have write permission to jPrint installation
                    subdirectory <filename>server/default/tmp</filename>).</para>
                  </listitem>
                </varlistentry>
              </variablelist>
            </listitem>

            <listitem>
              <para>Save the modified script to <filename>/etc/init.d/jprint</filename>
              and make it executable by the super-user:</para>

              <programlisting>$ chmod a+x /etc/init.d/jprint</programlisting>
            </listitem>

            <listitem>
              <para>Test your installation by calling the startup script in
              <filename>/etc/init.d</filename>:</para>

              <programlisting>$ /etc/init.d/jprint start</programlisting>

              <para>and evaluate successful startup by inspection of server
              log file <filename>server/default/log/server.log</filename>.</para>

              <para>Stop the server by</para>

              <programlisting>$ /etc/init.d/jprint stop</programlisting>
            </listitem>

            <listitem>
              <para>Create symbolic links <filename>S90jprint</filename> to
              <filename>/etc/init.d/jprint</filename> in <filename>/etc/rc.2</filename>,
              <filename>/etc/rc.2</filename>, <filename>/etc/rc.3</filename>
              to start jPrint when changing to the multi-user run-level:</para>

              <programlisting>$ ln -s /etc/init.d/jprint /etc/init.d/rc.2/S90jprint
$ ln -s /etc/init.d/jprint /etc/init.d/rc.3/S90jprint
$ ln -s /etc/init.d/jprint /etc/init.d/rc.4/S90jprint</programlisting>

              <para>Create symbolic links <filename>K10jprint</filename> to
              <filename>/etc/init.d/jprint</filename> in <filename>/etc/rc.0</filename>,
              <filename>/etc/rc.1</filename>, <filename>/etc/rc.6</filename>
              to stop jPrint when leaving the multi-user run-level:</para>

              <programlisting>$ ln -s /etc/init.d/jprint /etc/init.d/rc.0/K10jprint
$ ln -s /etc/init.d/jprint /etc/init.d/rc.1/K10jprint
$ ln -s /etc/init.d/jprint /etc/init.d/rc.6/K10jprint</programlisting>
            </listitem>
          </orderedlist>
        </section>
      </section>

      <section>
        <title>Install jPrint as Windows NT / W2K Service</title>

        <orderedlist>
          <listitem>
            <para>Open a console and change your working directory to the
            <filename>bin/</filename> directory of the distribution:</para>

            <programlisting>$ cd jprint-1.2.1\bin</programlisting>
          </listitem>

          <listitem>
            <para>Invoke <command>install_service</command> with
            <literal>server</literal> as parameter, to install the Windows
            Service using the Java HotSpot <emphasis>Server</emphasis> VM to
            run jPrint:</para>

            <programlisting>$ install_service server</programlisting>

            <para>Or invoke <command>install_service</command> with
            <literal>client</literal> as parameter, to install the Windows
            Service using the Java HotSpot <emphasis>Client</emphasis> VM to
            run jPrint:</para>

            <programlisting>$ install_service client</programlisting>

            <para>Using the server option is recommended (s.a. <ulink
            url="http://java.sun.com/j2se/1.4.1/docs/guide/vm/index.html">http://java.sun.com/j2se/1.4.1/docs/guide/vm/index.html</ulink>).
            But if only the Java 2 Runtime is installed you have to use the
            client option, because the Java HotSpot <emphasis>Server</emphasis>
            VM is only included in the Java 2 SDK distribution.</para>
          </listitem>

          <listitem>
            <para>[optional] Open the Windows Service Manager and verify, that
            the service was registered with the name <literal>jprint-1.2.x</literal>.
            It will be started automatically with the next system reboot. You
            may start it immediately by using the Windows Service Manager.</para>
          </listitem>
        </orderedlist>

        <section>
          <title>Uninstall the Windows NT / W2K Service</title>

          <para>To uninstall the service again you may invoke
          <command>install_service</command> with <literal>uninstall</literal>
          as parameter:</para>

          <programlisting>$ install_service uninstall</programlisting>

          <para>If the service was running, it will not be removed immediately
          by this command, but will be removed with next system reboot.</para>

          <para>To stop and remove the service immediately, you have to use
          the Windows Service Manger instead.</para>
        </section>
      </section>
    </section>

    <section>
      <title>Content of the jPrint installation directory</title>

      <para>The structure of the jPrint installation directory is shaped by
      the included JBoss application server distribution (s. <ulink
      url="http://www.jboss.org">http://www.jboss.org</ulink>):</para>

      <programlisting><filename>jprint-1.2.x/</filename>
 + <filename>bin/</filename>
 + <filename>client/</filename>
 + <filename>doc/</filename>
 + <filename>images/</filename>
 + <filename>lib/</filename>
 + <filename>server/</filename>
    + <filename>default/</filename>
       + <filename>conf/</filename>
          + <filename>annotation/</filename>
          + <filename>calibration/</filename>
          + <filename>lut/</filename>
       + <filename>deploy/</filename>
    + <filename>lib/</filename>
    + <filename>log/</filename>
    + <filename>tmp/</filename></programlisting>

      <para>The subdirectories <filename>log/</filename> and
      <filename>tmp/</filename> of directory <filename>jprint-1.2.x/server/default/</filename>
      are not part of the jPrint distribution package, but are created at
      first server startup.</para>

      <para>jprint-with-jaudit-1.2.x.zip contains additional subdirectories
      which are described at <xref linkend="jprint-with-jaudit" />.</para>

      <para>Subdirectory <filename>bin/</filename> contains executable jars of
      jPrint utilities and various shell scripts to start the server manually
      or automatically during system boot:</para>

      <variablelist>
        <varlistentry>
          <term><filename>bin/check-license.jar</filename></term>

          <listitem>
            <para>Executable jar of the <link linkend="check-license.jar">check-license.jar</link>
            utility, used to check if your license is valid for running jPrint
            1.2 on this host.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><filename>bin/list-printers.jar</filename></term>

          <listitem>
            <para>Executable jar of the <link linkend="list-printers.jar">list-printers.jar</link>
            utility, used to determine printer names of any installed system
            and network printers.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><filename>bin/print-image.jar</filename></term>

          <listitem>
            <para>Executable jar of the <link linkend="print-image.jar">print-image.jar</link>
            utility, used to print a DICOM image - particularly one of the
            test patterns in the <filename>images/</filename> subdirectory
            used for <link linkend="printer-calibration">Printer Calibration</link>.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><filename>bin/view-plut.jar</filename></term>

          <listitem>
            <para>Executable jar of the <link linkend="view-plut.jar">view-plut.jar</link>
            utility, used to visualize the effect of applying various
            Presentation LUTs on a particular DICOM image.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><filename>bin/view-printerODs.jar</filename></term>

          <listitem>
            <para>Executable jar of utility <link
            linkend="view-printerODs.jar">view-printerODs.jar</link> utility,
            used to evaluate the printer characteristic of scanned calibration
            pattern print-outs.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><filename>bin/run.jar</filename></term>

          <listitem>
            <para>Entry point jar of JBoss application server.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><filename>bin/run.sh</filename></term>

          <listitem>
            <para>Bash shell script to start the server on UNIX platforms.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><filename>bin/run.bat</filename></term>

          <listitem>
            <para>Windows batch file to start the server on WIndows platforms.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><filename>bin/install_service.bat</filename></term>

          <listitem>
            <para>Windows batch file to install/uninstall the server as
            Windows NT / W2K.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><filename>bin/JavaService.exe</filename></term>

          <listitem>
            <para>Windows executable required to run the server as Windows NT
            / W2K Service.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><filename>bin/jprint_init_debian.sh</filename></term>

          <listitem>
            <para>Server startup/shutdown script for Debian GNU/Linux systems.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><filename>bin/jprint_init_redhat.sh</filename></term>

          <listitem>
            <para>Server startup/shutdown script for RedHat Linux systems.</para>
          </listitem>
        </varlistentry>
      </variablelist>

      <para>The <filename>client/</filename> subdirectory contains the jars
      required for jPrint utilities (i.e.: <filename>bin/print-image.jar</filename>),
      to access JBoss services via the JMX/RMI adapter.</para>

      <para>The <filename>doc/</filename> subdirectory contains jPrint
      documentation files:</para>

      <variablelist>
        <varlistentry>
          <term><filename>doc/jprint-sm.pdf</filename></term>

          <listitem>
            <para>jPrint Service Manual (this document).</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><filename>doc/jprint-cs.pdf</filename></term>

          <listitem>
            <para>jPrint DICOM Conformance Statement.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><filename>doc/gsdf_od.xls</filename></term>

          <listitem>
            <para>Hardcopy Calibration Form (MS Excel spreadsheet) for
            qualitative verification of proper Printer Calibration [downloaded
            from IHE Year 3 Display Consistency page: <ulink
            url="http://wuerlim.wustl.edu/mesa/software/consistency/index.html">http://wuerlim.wustl.edu/mesa/software/consistency/index.html</ulink>].</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><filename>doc/gsdf_od.sxc</filename></term>

          <listitem>
            <para>Open Office Version of <filename>doc/gsdf_od.xls</filename>.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><filename>doc/display-consistency.pdf</filename></term>

          <listitem>
            <para><citetitle>Consistency of Softcopy and Hardcopy: Preliminary
            Experiences with the new DICOM Extensions for Image Display</citetitle>
            by Marco Eichelberg et al., which describes the DICOM concepts of
            a <literal>Grayscale Standard Display Function</literal>,
            <literal>Grayscale Softcopy Presentation State</literal> and
            <literal>Presentation Look Up Table</literal>, and why it&#39;s
            implementation by workstations, print composers and print servers
            improves the consistency between displayed and printed images.
            [downloaded from IHE Year 3 Display Consistency page: <ulink
            url="http://wuerlim.wustl.edu/mesa/software/consistency/index.html">http://wuerlim.wustl.edu/mesa/software/consistency/index.html</ulink>].</para>
          </listitem>
        </varlistentry>
      </variablelist>

      <para>Subdirectory <filename>images/</filename> contains DICOM files
      with test patterns:</para>

      <variablelist>
        <varlistentry>
          <term><filename>images/DSI16.dcm</filename></term>

          <listitem>
            <para>Philips dsitest image used for quantitative verification of
            proper Printer Calibration.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><filename>images/DSI256.dcm</filename></term>

          <listitem>
            <para>Modified Philips dsitest image with 256 different shades of
            gray used for Printer Calibration.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><filename>images/WEDGE8.dcm</filename></term>

          <listitem>
            <para>8-bit Wedge pattern with 256 different shades of gray for
            qualitative verification of print quality.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><filename>images/WEDGE12.dcm</filename></term>

          <listitem>
            <para>12-bit wedge pattern with 4096 different shades of gray for
            qualitative verification of print quality.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><filename>images/ASPECT.dcm</filename></term>

          <listitem>
            <para>Pixel Aspect Ratio pattern to test the support of Pixel
            Aspect Ratio by the Print Server.</para>
          </listitem>
        </varlistentry>
      </variablelist>

      <para>Subdirectory <filename>lib/</filename> contains startup jars used
      by JBoss.</para>

      <para>Subdirectory <filename>server/default/lib/</filename> contains
      additional jars required by JBoss&#39; internal services and deployed
      jPrint services.</para>

      <para>Subdirectory <filename>server/default/deploy/</filename> contains
      configuration files for any deployed jPrint services (as well as some
      that are used by JBoss):</para>

      <variablelist>
        <varlistentry>
          <term><filename>server/default/deploy/auditlog-service.xml</filename></term>

          <listitem>
            <para>Configures the Audit Logger Service, which controls the
            transmission of Audit Records generated by jPrint.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><filename>server/default/deploy/dcmsrv-service.xml</filename></term>

          <listitem>
            <para>Configures the generic DICOM Server Service.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><filename>server/default/deploy/prnscp-service.xml</filename></term>

          <listitem>
            <para>Configures the Print SCP Service, which spools received
            DICOM Print Requests to disk and schedules their processing by the
            Printer Service.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><filename>server/default/deploy/printer-service.xml</filename></term>

          <listitem>
            <para>Configures the Printer Service, which transforms spooled
            DICOM Print Requests to Print Jobs for a connected (system or
            network) printer.</para>
          </listitem>
        </varlistentry>
      </variablelist>

      <para>Subdirectory <filename>server/default/conf/</filename> contains
      all the remaining configuration files:</para>

      <variablelist>
        <varlistentry>
          <term><filename>server/default/conf/jboss-service.xml</filename></term>

          <listitem>
            <para>Defines JBoss&#39; core service configuration. You should
            not need to alter this configuration.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><filename>server/default/conf/jndi.properties</filename></term>

          <listitem>
            <para>Defines the JNDI Context used by JBoss internally. You
            should not need to alter this configuration.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><filename>server/default/conf/log4j.xml</filename></term>

          <listitem>
            <para>Configures the <ulink url="http://jakarta.apache.org/log4j">Apache
            log4j</ulink> framework category priorities and appenders used by
            JBoss and deployed the jPrint Service. <link linkend="log4j">Edit
            this file</link>, if you want to change the default logging
            behavior.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><filename>server/default/conf/license.jks</filename></term>

          <listitem>
            <para>Your license to run jPrint-1.2. It is not included in
            <filename>jprint-1.2.x.zip</filename>! You receive it separately
            by e-mail and have to copy it into <filename>server/default/conf/</filename>
            yourself. <filename>license.jks</filename> is also usable as
            server certificate, if operating the server in <link linkend="tls">secure
            mode (DICOM-TLS)</link>.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><filename>server/default/conf/cacerts.jks</filename></term>

          <listitem>
            <para>Contains certificates of trusted certification authorities.
            Only used in <link linkend="tls">secure mode (DICOM-TLS)</link>.</para>
          </listitem>
        </varlistentry>
      </variablelist>

      <para>The subdirectory <filename>server/default/conf/annotation</filename>
      contains configuration files specifying <link linkend="adf">Annotation
      Display Formats</link> provided by jPrint:</para>

      <variablelist>
        <varlistentry>
          <term><filename>server/default/conf/annotation/TITLE.5.adf</filename></term>

          <listitem>
            <para>Specifies Annotation Display Format <literal>TITLE</literal>:
            5 Annotation Boxes located on the four edges and one - with larger
            font size - centered at the top of the page. This is used for all
            DICOM prints with default
            server/default/deploy/printer-service.xml. Usually you will at
            least edit the specified <literal>Default Title</literal>.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><filename>server/default/conf/annotation/NO_TITLE.4.adf</filename></term>

          <listitem>
            <para>Specifies Annotation Display Format <literal>NO_TITLE</literal>:
            Like Annotation Display Format <literal>TITLE</literal>, but
            without a centered Annotation Box at the top of the page. This is
            used for print-outs initiated with utility <command>print-image.jar</command>
            in the default configuration.</para>
          </listitem>
        </varlistentry>
      </variablelist>

      <para>The subdirectory <filename>server/default/conf/calibration</filename>
      contains configuration files related to <link
      linkend="printer-calibration">Printer Calibration</link>:</para>

      <variablelist>
        <varlistentry>
          <term><filename>server/default/conf/calibration/DSI256.ods</filename></term>

          <listitem>
            <para>Contains list of measured values of optical densities of
            gray steps in reference sheet with DSI256 pattern.</para>
          </listitem>
        </varlistentry>
      </variablelist>

      <para>The subdirectory <filename>server/default/conf/lut</filename>
      contains DICOM files with <link linkend="lut">local Presentation Lookup
      Tables</link> provided by jPrint:</para>

      <variablelist>
        <varlistentry>
          <term><filename>server/default/conf/calibration/PHILIPS.lut</filename></term>

          <listitem>
            <para>Presentation LUT defined and used by PHILIPS.</para>
          </listitem>
        </varlistentry>
      </variablelist>
    </section>
  </section>

  <section>
    <title>Configuration</title>

    <para>Configuration of jPrint is based on simple (ASCII) text files, which
    can be modified by any text editor that treats ASCII files with a single
    linefeed as line delimiter (UNIX style) properly. <command>NotePad</command>
    on Microsoft Windows fails to do that, but you may use <command>WordPad,</command>
    which displays UNIX line formated text files correctly.</para>

    <section>
      <title>Deployed jPrint Services</title>

      <para>Configuration files in the <filename>server/default/deploy/</filename>
      subdirectory are one-to-one, related to instances of jPrint Services,
      which are deployed in the JBoss Application Server as so-called
      <literal>MBeans</literal> (managed beans), which provides, in
      cooperation with each other, the functionality needed to receive DICOM
      print requests and process them to print jobs forwarded to connected
      printer(s):</para>

      <variablelist>
        <varlistentry>
          <term><filename>server/default/deploy/auditlog-service.xml</filename></term>

          <listitem>
            <para>Configures the <link linkend="audit-logger-service">Audit
            Logger Service</link>, which controls the transmission of Audit
            Records generated by jPrint. Edit this file to change the host
            (default: localhost) or port (default: 4000) of the syslog server,
            to which Audit Records shall be transmitted.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><filename>server/default/deploy/dcmsrv-service.xml</filename></term>

          <listitem>
            <para>Configures the generic <link linkend="dicom-server">DICOM
            Server</link>. Edit this file to change the server port (default:
            6104) or to switch to secure mode (DICOM-TLS).</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><filename>server/default/deploy/prnscp-service.xml</filename></term>

          <listitem>
            <para>Configures the <link linkend="print-scp-service">Print SCP
            Service</link>, which spools received DICOM Print Requests to disk
            and schedules their processing by the Printer Service. Edit this
            file to change the default spool directory [<filename>server/deafult/tmp/spool</filename>],
            to keep spooled Print Requests for debugging or for adjusting
            local Presentation LUTs to particular Print Requests.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><filename>server/default/deploy/printer-service.xml</filename></term>

          <listitem>
            <para>Configures the <link linkend="printer-service">Printer
            Service</link>, which transforms spooled DICOM Print Requests to
            Print Jobs for a connected (system or network) printer. You have
            to edit this file to specify a valid (=existing) printer name on
            your system. Also the Called AET (default is <literal>TIANI_PRINT</literal>),
            with which this printer must be addressed by a Print Composer, is
            specified here.</para>
          </listitem>
        </varlistentry>
      </variablelist>

      <section id="audit-logger-service">
        <title>Audit Logger Service</title>

        <para>The Audit Logger Service controls the transmission of Audit
        Records generated by jPrint.</para>

        <para>The following attributes are defined by it&#39;s configuration
        file (<filename>server/default/deploy/auditlog-service.xml</filename>):</para>

        <table>
          <title>Audit Logger Service Configuration Parameters</title>

          <tgroup cols="3">
            <colspec colwidth="100" />

            <colspec colwidth="80" />

            <thead>
              <row>
                <entry>Attribute Name</entry>

                <entry>Default Value</entry>

                <entry>Description</entry>
              </row>
            </thead>

            <tbody>
              <row>
                <entry><literal>SyslogHost</literal></entry>

                <entry><literal>localhost</literal></entry>

                <entry>Specifies host name or IP address of the Audit Record
                Repository to which Audit Records shall be transmitted.</entry>
              </row>

              <row>
                <entry><literal>SyslogPort</literal></entry>

                <entry><literal>4000</literal></entry>

                <entry>Specifies UDP port on which the Audit Record Repository
                is listening.</entry>
              </row>

              <row>
                <entry><literal>Facility</literal></entry>

                <entry><literal>authpriv</literal></entry>

                <entry>Specifies the value of the Facility element in the
                Syslog header of transmitted Audit Records. Possible values
                are: <literal>user</literal>, <literal>auth</literal>,
                <literal>authpriv</literal>, <literal>local0</literal>,
                <literal>local1</literal>, ... , <literal>local7</literal></entry>
              </row>

              <row>
                <entry><literal>LogActorStartStop</literal></entry>

                <entry><literal>true</literal></entry>

                <entry>Set to <literal>false,</literal> to deactivate
                transmission of ActorStartStop Audit messages.</entry>
              </row>

              <row>
                <entry><literal>LogSecurityAlert</literal></entry>

                <entry><literal>true</literal></entry>

                <entry>Set to <literal>false,</literal> to deactivate
                transmission of <literal>SecurityAlert</literal> Audit
                messages.</entry>
              </row>

              <row>
                <entry><literal>LogActorConfig</literal></entry>

                <entry><literal>true</literal></entry>

                <entry>Set to <literal>false,</literal> to deactivate
                transmission of <literal>ActorConfig</literal> Audit messages.</entry>
              </row>

              <row>
                <entry><literal>LogExport</literal></entry>

                <entry><literal>true</literal></entry>

                <entry>Set to <literal>false,</literal> to deactivate
                transmission of <literal>Export</literal> Audit messages.</entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </section>

      <section id="dicom-server">
        <title>DICOM Server</title>

        <para>General DICOM Server with support of secure (DICOM-TLS) mode. In
        secure mode SecurityAlert Audit Records will be generated and
        forwarded for transmission to the Audit Logger Service in the case of
        a connection attempt by an unauthorized client.</para>

        <para>The following attributes are defined by it&#39;s configuration
        file <filename>(server/default/deploy/dcmsrv-service.xml</filename>):</para>

        <table>
          <title>DICOM Server Configuration Parameters</title>

          <tgroup cols="3">
            <colspec colwidth="140" />

            <colspec colwidth="120" />

            <thead>
              <row>
                <entry>Attribute Name</entry>

                <entry>Default Value</entry>

                <entry>Description</entry>
              </row>
            </thead>

            <tbody>
              <row>
                <entry>MaxClients</entry>

                <entry>10</entry>

                <entry>Set maximal number of simultaneously connected DICOM
                clients.</entry>
              </row>

              <row>
                <entry>ProtocolName</entry>

                <entry>dicom</entry>

                <entry>Specifies whether the server runs in TLS mode:<variablelist><varlistentry><term>dicom</term><listitem><para>native
                DICOM (without TLS).</para></listitem></varlistentry><varlistentry><term>dicom-tls</term><listitem><para>DICOM
                over TLS; triple DES EDE CBC encryption is provided, but not
                forced by the server.</para></listitem></varlistentry><varlistentry><term>dicom-tls.3des</term><listitem><para>DICOM
                over TLS with triple DES EDE CBC encryption</para></listitem></varlistentry><varlistentry><term>dicom-tls.nodes</term><listitem><para>DICOM
                over TLS without encryption</para></listitem></varlistentry></variablelist></entry>
              </row>

              <row>
                <entry>Port</entry>

                <entry>6104</entry>

                <entry>Specifies TCP port on which the DICOM server is
                listening.</entry>
              </row>

              <row>
                <entry>CalledAETs</entry>

                <entry>any</entry>

                <entry><para>Specifies Called AETs, which the DICOM server
                shall accept. Multiple values can be specified, separated by
                &#39;\&#39; characters. Use the single value &#34;<literal>any&#34;</literal>
                to accept any Called AET in the A-ASSOCIATE RQ.</para><para>Whether
                DICOM Print Services are actually provided depends, if there
                is a Printer Service associated to the Called AET in the
                A-ASSOCIATE RQ configured. If not, only the DICOM Verification
                Service will be provided by the server.</para></entry>
              </row>

              <row>
                <entry>CallingAETs</entry>

                <entry>any</entry>

                <entry>Specifies Calling AETs, which the DICOM server shall
                accept. Multiple values can be specified, separated by
                &#39;\&#39; characters. Use the single value &#34;<literal>any&#34;</literal>
                to accept any Called AET in the A-ASSOCIATE RQ.</entry>
              </row>

              <row>
                <entry>RqTimeout</entry>

                <entry>5000</entry>

                <entry>Specifies Timeout in ms, the DICOM server will wait
                after accepting the TCP connect for the A-ASSOCIATE RQ.
                &#34;0&#34; means, there is no Timeout, so the server would
                wait as long the TCP connection is open by the peer
                application.</entry>
              </row>

              <row>
                <entry>DimseTimeout</entry>

                <entry>60000</entry>

                <entry>Specifies Timeout in ms, the DICOM server will wait
                after the receive of DIMSE message on an established
                association. &#34;0&#34; means, there is no Timeout.</entry>
              </row>

              <row>
                <entry>SoCloseDelay</entry>

                <entry>500</entry>

                <entry>Specifies Timeout in ms, the DICOM server will wait
                after sending a A-RELEASE RSP or an A-ABORT RQ for DIMSE
                message on an established association. &#34;0&#34; means,
                there is no Timeout.</entry>
              </row>

              <row>
                <entry>MaxPDULength</entry>

                <entry>16352</entry>

                <entry>Specifies maximal PDU package length for receiving
                PDUs.</entry>
              </row>

              <row>
                <entry>PackPDVs</entry>

                <entry>false</entry>

                <entry><para>Specifies if Command and Data PDVs can be packed
                in one PDU.</para><para>There are well-known bugs of some
                DICOM implementations in supporting this performance-improving
                DICOM feature.</para></entry>
              </row>

              <row>
                <entry>KeyFile</entry>

                <entry>conf/license.jks</entry>

                <entry>Defines file containing key used in SSL handshake, when
                running in TLS mode. Relative path names are resolved using
                JBoss server directory as a base directory.</entry>
              </row>

              <row>
                <entry>KeyPasswd</entry>

                <entry>passwd</entry>

                <entry>Defines password for access to the key file, specified
                by the KeyFile attribute.</entry>
              </row>

              <row>
                <entry>CacertsFile</entry>

                <entry>conf/cacerts.jks</entry>

                <entry>Defines file containing accepted certificates, when
                running in TLS mode. Relative path names are resolved using
                JBoss server directory as a base directory.</entry>
              </row>

              <row>
                <entry>CacertsPasswd</entry>

                <entry>passwd</entry>

                <entry>Defines password for access to the cacerts file,
                specified by the CacertsFile attribute.</entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </section>

      <section id="print-scp-service">
        <title>Print SCP Service</title>

        <para>The Print SCP Service is registered at the DICOM server. It
        spools received DICOM Print Requests to disk and schedules their
        processing by the connected Printer Service, which is associated with
        the Called AET used by the Print Composer in the Association Request.
        It also generates Audit Records for requested/performed Print Jobs and
        forwards them to the Audit Logger Service for transmission to the
        Audit Record Repository.</para>

        <para>The following attributes are defined by it&#39;s configuration
        file (<filename>server/default/deploy/prnscp-service.xml</filename>):</para>

        <table>
          <title>Print SCP Service Configuration Parameters</title>

          <tgroup cols="3">
            <colspec colwidth="100" />

            <colspec colwidth="80" />

            <thead>
              <row>
                <entry>Attribute Name</entry>

                <entry>Default Value</entry>

                <entry>Description</entry>
              </row>
            </thead>

            <tbody>
              <row>
                <entry>AuditCreateSession</entry>

                <entry>true</entry>

                <entry>Defines whether an Audit Record shall be generated for
                each successful created Film Session Instance. Only
                AuditCreateSession OR AuditCreateFilmBox OR AuditPrintJob
                shall be set to true.</entry>
              </row>

              <row>
                <entry>AuditCreateFilmBox</entry>

                <entry>false</entry>

                <entry>Defines whether an Audit Record shall be generated for
                each successful created Film Box Instance. Only
                AuditCreateSession OR AuditCreateFilmBox OR AuditPrintJob
                shall be set to true.</entry>
              </row>

              <row>
                <entry>AuditPrintJob</entry>

                <entry>false</entry>

                <entry>Defines whether an Audit Record shall be generated for
                each scheduled Print Job. Usually one Audit Record is
                generated for every printed page, because most Print SCUs
                request a separate Print Job for each page to print. Only
                AuditCreateSession OR AuditCreateFilmBox OR AuditPrintJob
                shall be set to true.</entry>
              </row>

              <row>
                <entry>LicenseFile</entry>

                <entry>conf/license.jks</entry>

                <entry>Defines the file containing the license to run jPrint.
                Relative path names are resolved using the JBoss server
                directory as a base directory.</entry>
              </row>

              <row>
                <entry>LicensePasswd</entry>

                <entry></entry>

                <entry>Defines the password for access to license file,
                specified by the LicenseFile attribute. This must be
                specified, if the license is stored in PKCS #12 [.p12]
                keystore.</entry>
              </row>

              <row>
                <entry>SpoolDirectory</entry>

                <entry>tmp/spool</entry>

                <entry>Specifies the spool directory used for buffering print
                jobs, before they can be forwarded to the printer. Relative
                path names are resolved using the JBoss server directory as a
                base directory.</entry>
              </row>

              <row>
                <entry>KeepSpoolFiles</entry>

                <entry>false</entry>

                <entry>Set to true to keep spooled files for debugging.</entry>
              </row>

              <row>
                <entry>MaskWarningAsSuccess</entry>

                <entry>false</entry>

                <entry>Set to true, to return success status in DIMSE RSP
                message instead of a warning. Workaround for print clients,
                which abort the print request if they receive a warning
                response status.</entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </section>

      <section id="printer-service">
        <title>Printer Service</title>

        <para>The Printer Service transforms spooled DICOM Print Requests to
        Print Jobs for a connected (system or network) printer.</para>

        <para>The Printer Service configuration also defines the Called AET,
        which have to be used by a Print Composer in the DICOM Association
        Request. It is possible to configure several Printer Services, each
        with different Called AETs, to enable print-outs on several different
        physical printers connected to the system.</para>

        <para>At default, only one Printer Service, associated with Called AET
        <literal>TIANI_PRINT</literal> is configured by the file
        <filename>server/default/deploy/printer-service.xml</filename>:</para>

        <programlisting>&#60;!-- ===================================================================== --&#62;
&#60;!--                                                                       --&#62;
&#60;!--  Printer Service Configuration                                        --&#62;
&#60;!--                                                                       --&#62;
&#60;!-- ===================================================================== --&#62;

&#60;server&#62;

  &#60;classpath codebase=&#34;lib&#34; archives=&#34;dcm4che.jar,prnscp.jar&#34;/&#62;

    &#60;!--
    Name property calledAET defines the DICOM Called AET to which this
    Print Service is bound. If multiple Print Services are configured -
    associated with different Printers or specifying different configuration
    settings for the same Printer - they have to be distinguished by different
    calledAET values.
    --&#62;
  &#60;mbean code=&#34;com.tiani.prnscp.print.PrinterService&#34; 
         name=&#34;dcm4chex:service=Printer,calledAET=TIANI_PRINT&#34;&#62;
...</programlisting>

        <para>The following additional attributes are defined by it&#39;s
        configuration file <filename>(server/default/deploy/printer-service.xml):</filename></para>

        <table id="tPrinterCfg">
          <title>Printer Service Configuration Parameters</title>

          <tgroup cols="3">
            <colspec colwidth="140" />

            <colspec colwidth="120" />

            <thead>
              <row>
                <entry>Attribute Name</entry>

                <entry>Default Value</entry>

                <entry>Description</entry>
              </row>
            </thead>

            <tbody>
              <row>
                <entry>PrinterName</entry>

                <entry>myprinter</entry>

                <entry>Specifies name of the printer used by the system. Must
                be one of the print names listed by the <link
                linkend="list-printers.jar">list-printers.jar</link> utility.</entry>
              </row>

              <row>
                <entry>Manufacturer</entry>

                <entry></entry>

                <entry>Specifies the manufacturer of the printer, returned in
                the Manufacturer attribute (0008,0070) of the Printer
                Information Object by the N-GET Service of the DICOM Printer
                SOP Class.</entry>
              </row>

              <row>
                <entry>ManufacturerModelName</entry>

                <entry></entry>

                <entry>Specifies the manufacturer&#39;s model number of the
                printer, returned in the Manufacturer Model Name attribute
                (0008,1090) of the Printer Information Object by the N-GET
                Service of the DICOM Printer SOP Class.</entry>
              </row>

              <row>
                <entry>DeviceSerialNumber</entry>

                <entry></entry>

                <entry>Specifies the manufacturer&#39;s serial number of the
                printer, returned in the Device Serial Number attribute
                (0018,1000) of the Printer Information Object by the N-GET
                Service of the DICOM Printer SOP Class.</entry>
              </row>

              <row>
                <entry>SoftwareVersion</entry>

                <entry></entry>

                <entry>Specifies the manufacturer&#39;s designation of the
                software version of the printer, returned in the Software
                Versions attribute (0018,1020) of the Printer Information
                Object by the N-GET Service of the DICOM Printer SOP Class.</entry>
              </row>

              <row>
                <entry>MaxQueuedJobCount</entry>

                <entry>10</entry>

                <entry>Specifies maximal number of jobs in the printer job
                queue. Printer Jobs will be locally buffered, as long the
                current number of jobs queued by the printer exceeds this
                value.</entry>
              </row>

              <row>
                <entry>WarnJobQueued</entry>

                <entry>false</entry>

                <entry>Specifies if Printer Status show warning if print
                job(s) in Queue.</entry>
              </row>

              <row>
                <entry>IgnorePrinterIsAcceptingJobs</entry>

                <entry>true</entry>

                <entry>Specifies, whether the state of the IPP attribute,
                ACCEPTING_JOBS, queried from the printer, shall be ignored.
                This is necessary with current J2SDK 1.4.1 for Linux, because
                the returned attribute value is always NOT_ACCEPTING_JOBS,
                even the printer is actually ready to accept jobs.</entry>
              </row>

              <row>
                <entry>SupportsGrayscale</entry>

                <entry>true</entry>

                <entry>Specifies whether the Basic Grayscale Print Management
                Meta SOP Class shall be provided. There is no reason to
                deactivate grayscale printing (except for debugging): to
                evaluate the behavior of Print Clients in the (unusual) case
                that a DICOM print server rejects the use of the Basic
                Grayscale Print Management Meta SOP Class. At least the
                SupportsGrayscale or SupportsColor attribute must be set to
                true, otherwise no printing at all is possible.</entry>
              </row>

              <row>
                <entry>SupportsColor</entry>

                <entry>true</entry>

                <entry>Specifies whether the Basic Color Print Management Meta
                SOP Class shall be provided. Usually, you will set it to
                false, if the connected printer does not support color
                printing. At least the SupportsGrayscale or SupportsColor
                attribute must be set to true, otherwise no printing at all is
                possible.</entry>
              </row>

              <row>
                <entry>SupportsPresentationLUT</entry>

                <entry>true</entry>

                <entry>Specifies whether the Presentation LUT SOP Class shall
                be provided.</entry>
              </row>

              <row>
                <entry>SupportsAnnotationBox</entry>

                <entry>true</entry>

                <entry>Specifies whether the Presentation Basic Annotation Box
                SOP Class shall be provided.</entry>
              </row>

              <row>
                <entry>PrintGrayAsColor</entry>

                <entry>false</entry>

                <entry>Specifies whether color mode of the (color) printer
                shall be also used for printing of monochrome (=grayscale)
                images. Some printers achieve a better dynamic range -
                particularly a higher optical density for black - in color
                mode, than in monochrome mode. But usually, gray scale images
                printed in color mode shows some color shades. It also depends
                on the preferences of the user, whether the visible quality of
                grayscale image print outs can be improved by printing in
                color mode.</entry>
              </row>

              <row>
                <entry>ApplyPLUTonRGB</entry>

                <entry>10</entry>

                <entry>Specifies whether PLUTs shall be also applied on RGB
                values of color images:<variablelist><varlistentry><term>&#60;
                0</term><listitem><para>no P-LUT will be applied</para></listitem></varlistentry><varlistentry><term>=
                0</term><listitem><para>P-LUT will be only applied to pure
                gray values (R=G=B)</para></listitem></varlistentry><varlistentry><term>&#62;
                0</term><listitem><para>P-LUT will be applied for pixels with
                max(|R-G|,|G-B|,|B-R|) &#60;= ApplyPLUTonRGB</para></listitem></varlistentry></variablelist></entry>
              </row>

              <row>
                <entry>IgnoreMinDensity</entry>

                <entry>true</entry>

                <entry>Specifies whether Min Density values provided by Print
                Clients shall be ignored, assuming Min Density = 0 instead.
                This is a workaround for Print Clients, which cannot be
                configured, to send a zero - or no value at all - for Min
                Density. Using Min Density &#62; 0 for paper print is rarely
                reasonable, but only a waste of the dynamic range of the
                print-out, which is already quite limited in the case of paper
                printers, compared to film printers.</entry>
              </row>

              <row>
                <entry>MaxNumberOfCopies</entry>

                <entry>99</entry>

                <entry>Defines Maximal Number of Copies accepted by the Print
                SCP.</entry>
              </row>

              <row>
                <entry>MediumType</entry>

                <entry>PAPER</entry>

                <entry>Medium Type identifiers supported by the printer for
                the Basic Film Session. Multiple values can be specified,
                separated by &#39;\&#39; characters. The first specified value
                is used as the default.</entry>
              </row>

              <row>
                <entry id="SessionLabel">SessionLabel</entry>

                <entry>print job for $CALLING_AET$</entry>

                <entry>Defines default Session Label that is used when the
                Print SCU does not specify a Session Label. $CALLING_AET$,
                $DATE$, $TIME$ will be replaced by current values.</entry>
              </row>

              <row>
                <entry>DisplayFormat</entry>

                <entry><literallayout>1,1\1,2\2,2\2,3\3,3\
3,4\3,5\4,4\4,5\4,6\
5,5\5,6\6,6</literallayout></entry>

                <entry>Specifies all STANDARD\C,R image display formats
                accepted by the Print SCP for portrait orientation. Landscape
                image display formats are derived automatically.</entry>
              </row>

              <row>
                <entry>FilmSizeID</entry>

                <entry><literallayout>A4:210x297
A3:297x420
8INX10IN:203x254
8_5INX11IN:216x279
10INX12IN:265x305
10INX14IN:265x355
11INX14IN:279x355
11INX17IN:265x432
14INX14IN:355x355
14INX17IN:432x432
24CMX24CM:240x240
24CMX30CM:240x300</literallayout></entry>

                <entry><para>Film Size ID identifiers supported by the printer
                for the Basic Film Box. Multiple values can be specified,
                separated by &#39;\&#39; characters or line breaks. Format:
                id:WidthxHeight, with width and height in mm. The first
                specified value is used as the default Film Size.</para><para>If
                a Print Composer cannot be configured to send the proper Film
                Size ID for the Page Format, supported by the Printer (e.g.
                &#34;A3&#34;), the ID which is provided by the Print SCU (e.g.
                &#34;14INx17IN) can be mapped to the dimension of the paper
                size available at the Printer (e.g.
                &#34;14INx17IN:297x420&#34;).</para></entry>
              </row>

              <row>
                <entry id="PageMargin">PageMargin</entry>

                <entry>10,10,10,10</entry>

                <entry>Defines the page margin for portrait orientation.
                Format: left,right,top,bottom margin in mm. Page margins for
                landscape orientation are automatically derived from this
                attribute&#39;s value (s. attribute ReverseLandscape)</entry>
              </row>

              <row>
                <entry>BorderThickness</entry>

                <entry>2.0</entry>

                <entry>Defines the minimal spacing between images on the page
                in mm.</entry>
              </row>

              <row>
                <entry>DefaultPortrait</entry>

                <entry>true</entry>

                <entry>Defines the default film orientation that is used when
                the Print SCU does not specify film orientation.</entry>
              </row>

              <row>
                <entry>ReverseLandscape</entry>

                <entry>true</entry>

                <entry>Defines the direction of printing in landscape
                orientation. Page margin for landscape format derived from the
                specification for portrait orientation. If true, the left side
                of the page in landscape orientation corresponds to the top
                side in portrait orientation, etc.</entry>
              </row>

              <row>
                <entry>MagnificationType</entry>

                <entry><literallayout>BILINEAR\
REPLICATE\
NONE</literallayout></entry>

                <entry>Magnification Type identifiers supported by the printer
                for the Basic Film Box or Basic Grayscale Image Box. Multiple
                values can be specified, separated by &#39;\&#39; characters.
                The first specified value is used as the default.</entry>
              </row>

              <row>
                <entry>DecimateCropBehavior</entry>

                <entry>DECIMATE</entry>

                <entry>Defines the default Decimate/Crop Behavior that is used
                when the Print SCU does not specify a Requested Decimate/Crop
                Behavior.</entry>
              </row>

              <row>
                <entry>DecimateByNearestNeighbor</entry>

                <entry>true</entry>

                <entry>Defines, if Nearest Neighbor Interpolation is used for
                down-scaling, instead using same interpolation types as
                specified for magnification. Usually, you do not need to
                change the default value: true.</entry>
              </row>

              <row>
                <entry>MinimizeJobsize</entry>

                <entry>true</entry>

                <entry>Activates down-scaling to minimize printer job size.
                Usually, you need not change the default value: true.</entry>
              </row>

              <row>
                <entry>ChunkSize</entry>

                <entry>10</entry>

                <entry>Defines the maximal scaling chunk size in MB. The
                smaller the value, the larger the number of chunks an image
                must be divided into for scaling. This influences necessary
                memory requirements (-Xmx value). Usually, you do not need to
                change the default value of 10.</entry>
              </row>

              <row>
                <entry>BorderDensity</entry>

                <entry>WHITE</entry>

                <entry>Defines the default Border Density identifier that is
                used when the Print SCU does not specify Border Density.</entry>
              </row>

              <row>
                <entry>Trim</entry>

                <entry>YES</entry>

                <entry>Defines the default Trim behavior that is used when the
                Print SCU does not specify Trim.</entry>
              </row>

              <row>
                <entry>ResolutionID</entry>

                <entry><literallayout>STANDARD:600x600\
HIGH:1200x1200</literallayout></entry>

                <entry>Requested Resolution ID identifiers supported by the
                printer for the Basic Film Box. Multiple values can be
                specified, separated by &#39;\&#39; characters. The first
                specified value is used as the default.</entry>
              </row>

              <row>
                <entry>Illumination</entry>

                <entry>150</entry>

                <entry>Defines the default Illumination that is used when the
                Print SCU does not specify an Illumination value for applying
                the presentation LUT.</entry>
              </row>

              <row>
                <entry>ReflectedAmbientLight</entry>

                <entry>0</entry>

                <entry>Defines the default Reflected Ambient Light that is
                used when the Print SCU does not specify a Reflected Ambient
                Light value for applying the presentation LUT. For reflective
                media, such as paper, it must be 0 by definition! So it is not
                reasonable to change the default value in this case.</entry>
              </row>

              <row>
                <entry>LUTDir</entry>

                <entry>conf/lut</entry>

                <entry><para>Defines the default directory, which contains
                Presentation LUTs as DICOM files, which can be selected by a
                Print SCU via the value of the Film Box attribute (2010,0150)
                Configuration Information: shape=&#60;LUT-name&#62;. </para><para>Only
                effective, if the Print SCU does not provide a P-LUT itself
                using the P-LUT SOP class.</para><para>Relative path names are
                resolved using the JBoss server directory as a base directory.</para><para>Usually,
                you do not need to change the default value: conf/lut.</para></entry>
              </row>

              <row>
                <entry id="ConfInfoForCallingAET"><literallayout>ConfigurationInformation
ForCallingAET</literallayout></entry>

                <entry><literallayout>.grayscale:shape=IDENTITY
.color:shape=IDENTITY</literallayout></entry>

                <entry><para>Associates Calling AETs with Configuration
                Information values. Only effective, if the calling Print SCU
                provides neither a P-LUT using the P-LUT SOP class, nor a
                value for the Film Box attribute (2010,0150) Configuration
                Information. (see <xref linkend="local-luts" />)</para><para>Multiple
                entires must be separated by &#39;\&#39; characters or line
                breaks.</para><para>Format:
                &#60;calling-aet&#62;[.grayscale|.color]:&#60;Configuration
                Information Value&#62; (see. <xref linkend="local-luts" />)</para><para>The
                optional [.grayscale|.color] suffix allows to associate
                different Configuration Information values for Grayscale and
                Color Print to a Calling AET.</para><para>If no entries match
                the calling AET, the Configuration Information specified by</para><itemizedlist><listitem><para><literal>.grayscale:</literal><replaceable>&#60;Default
                Configuration Information Value for Grayscale Print&#62;</replaceable></para></listitem><listitem><para><literal>.color:</literal><replaceable>&#60;Default
                Configuration Information Value for Color Print&#62;</replaceable></para></listitem></itemizedlist><para>will
                be used. These two entries must be configured!</para></entry>
              </row>

              <row>
                <entry>AnnotationDir</entry>

                <entry>conf/annotation</entry>

                <entry><para>Specifies the directory which contains
                configuration files for supported annotation display formats.
                Relative path names are resolved using the JBoss server
                directory as a base directory.</para><para>Usually, you do not
                need to change the default value: conf/annotation.</para></entry>
              </row>

              <row>
                <entry id="AnnotationForCallingAET">AnnotationForCallingAET</entry>

                <entry>AET:TITLE</entry>

                <entry><para>Associates Calling AETs with Annotation Display
                Format available in the directory specified by attribute
                AnnotationDir.</para><para>This configuration parameter is
                only effective if the calling Print SCU does not specify an
                annotation display format.</para><para>Multiple entires must
                be separated by &#39;\&#39; characters or line breaks. If no
                entries match the calling AET, the Presentation LUT specified
                in the first entry will be used. At least one entry must be
                configured!</para><para>Format:
                &#60;calling-aet&#62;:&#60;annotation ID&#62;</para></entry>
              </row>

              <row>
                <entry>AnnotationForPrintImage</entry>

                <entry>NO_TITLE</entry>

                <entry><para>Specifies name of annotation display format used
                for the print image printout.</para><para>Usually, you do not
                need to change the default value: NO_TITLE</para></entry>
              </row>

              <row>
                <entry id="DateFormat">DateFormat</entry>

                <entry>yyyy-MM-dd</entry>

                <entry>Defines Date Format used in Annotations.</entry>
              </row>

              <row>
                <entry id="TimeFormat">TimeFormat</entry>

                <entry>HH:mm:ss</entry>

                <entry>Defines Time Format used in Annotations.</entry>
              </row>

              <row>
                <entry>CalibrationDir</entry>

                <entry>conf/calibration</entry>

                <entry><para>Specifies directory, containing calibration
                related configuration files:</para><variablelist><varlistentry><term><filename>DSI256.ods</filename></term><listitem><para>measured
                (256) OD values of reference DSI256 pattern</para></listitem></varlistentry><varlistentry><term><filename>&#60;calledAET&#62;.monochrome.ods</filename></term><listitem><para>OD
                values in monochrome mode. Measured from monochrome print-out
                of DSI16 or DSI256 pattern or calculated from most recent
                &#60;calledAET&#62;.monochrome/*.jpg</para></listitem></varlistentry><varlistentry><term><filename>&#60;calledAET&#62;.color.ods</filename></term><listitem><para>OD
                values in color mode. Measured from color print-out of DSI16
                or DSI256 pattern or calculated from most recent
                &#60;calledAET&#62;.color/*.jpg</para></listitem></varlistentry><varlistentry><term><filename>DSI256.jpg</filename></term><listitem><para>scanned
                reference DSI256 pattern</para></listitem></varlistentry><varlistentry><term><filename>&#60;calledAET&#62;.monochrome/*.jpg</filename></term><listitem><para>scanned
                DSI256 pattern printed in monochrome mode</para></listitem></varlistentry><varlistentry><term><filename>&#60;calledAET&#62;.color/*.jpg</filename></term><listitem><para>scanned
                DSI256 pattern printed in color mode</para></listitem></varlistentry></variablelist><para>Relative
                path names are resolved using the JBoss server directory as a
                base directory.</para><para>Usually, you do not need to change
                the default value: conf/calibration.</para><para>See <xref
                linkend="printer-calibration" />.</para></entry>
              </row>

              <row>
                <entry>ScanThreshold</entry>

                <entry>200</entry>

                <entry><para>Specifies the threshold in device driving levels
                (DDL), used for Border Detection by the printer OD calculation
                from a scanned DSI256 pattern print-out in the automatic
                Printer Calibration procedure.</para><para>Usually, you do not
                need to change the default value: 200.</para></entry>
              </row>

              <row>
                <entry>ScanPointExtension</entry>

                <entry>50</entry>

                <entry><para>Specifies the extension of measurement area as a
                percentage of the box dimension, used by printer OD
                calculation from scanned DSI256 pattern print-out in the
                automatic Printer Calibration procedure.</para><para>Usually,
                you do not need to change the default value: 50.</para></entry>
              </row>

              <row>
                <entry>AssumeZeroMinOD</entry>

                <entry>true</entry>

                <entry><para>Specifies if printer ODs calculated from scanned
                DSI256 pattern printout shall be adjusted to min OD = 0, to
                decrease derivation from actual ODs caused by limited gray
                resolution of scanned printout..</para><para>Usually, you do
                not need to change the default value: true.</para></entry>
              </row>

              <row>
                <entry>SkipNonMonotonicODs</entry>

                <entry>5</entry>

                <entry><para>Specifies tolerable loss (in %) of print dynamic
                (maximum OD) to avoid use of DDL values in non
                monotonically-decreasing parts of the printer characteristic
                curve.</para><para>Usually, you do not need to change the
                default value: 5.</para></entry>
              </row>

              <row>
                <entry>SmoothODs</entry>

                <entry>true</entry>

                <entry><para>Specifies if the measured/calculated ODs of the
                printer characteristic shall be smoothed to avoid any
                quantization effects caused by the limited resolution of OD
                measurements or scanned pixel values.</para><para>Usually, you
                do not need to change the default value: true.</para></entry>
              </row>

              <row>
                <entry>PrintToFile</entry>

                <entry>false</entry>

                <entry><para>Activates redirection of all printing into a
                postscript file, specified by the PrintToFilePath attribute.</para><para>This
                is only used for debugging.</para></entry>
              </row>

              <row>
                <entry>PrintToFilePath</entry>

                <entry>out.ps</entry>

                <entry>Specifies the path of the postscript file, to which all
                printing is redirected, if the PrintToFile attribute is set to
                true.</entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </section>

      <section>
        <title>Dependencies between jPrint Services</title>

        <para>In the default configuration, there is only one instance of each
        type of jPrint Service configured. There may be use cases (e.g.: to
        connect to two different printers) where several instances of one type
        of jPrint Service (e.g. The Printer Service) have to be configured. In
        that case, a modified copy of the configuration file for the primary
        service instance (e.g. <filename>printer-service.xml</filename>) has
        to be stored into the same directory as <replaceable>&#60;any
        name&#62;</replaceable><literal>-service.xml</literal>. In general,
        the actual name of a service configuration file does not matter, as
        long it ends with <literal>-service.xml</literal>.</para>

        <para><xref linkend="fig-jprint-service" />Shows the dependencies
        between the types of jPrint Services.</para>

        <figure id="fig-jprint-service">
          <title>jPrint Services</title>

          <mediaobject>
            <imageobject>
              <imagedata fileref="../img/jPrint-ug.gif" />
            </imageobject>
          </mediaobject>
        </figure>

        <para>DICOM Server, Print SCP and Print Service make use of the same
        Audit Logger Service. Every Printer Service is connected to one Print
        SCP Service which is itself registered to one DICOM Server instance.
        But there may be more than one Printer Service connected to the same
        Print SCP instance.</para>

        <para>If several DICOM server instances are running, for example, one
        in secure (DICOM-TLS) mode and another without TLS, not only does the
        configuration file for the DICOM server, <filename>dcmsrv-service.xml,</filename>
        need to be cloned and modified for each additional DICOM server that
        will be running, but new instances of the Print SCP and the Printer
        Service have to be configured by additional copies of
        <filename>prnscp-service.xml</filename> and <filename>printer-service.xml</filename>
        as well. This is because one Print SCP service cannot be registered to
        more than one DICOM server, just as one Printer Service cannot be
        connected to several different Print SCP services!</para>

        <para>The relationship between different service instances is defined
        by <literal>&#60;depends&#62;</literal> elements in the configuration
        files. E.g. in <filename>printer-service.xml</filename>:</para>

        <programlisting>  &#60;mbean code=&#34;com.tiani.prnscp.print.PrinterService&#34; 
         name=&#34;dcm4chex:service=Printer,calledAET=TIANI_PRINT&#34;&#62;
    &#60;depends optional-attribute-name=&#34;PrintSCPName&#34;&#62;
        dcm4chex:service=PrintSCP
    &#60;/depends&#62;
    &#60;depends optional-attribute-name=&#34;AuditLoggerName&#34;&#62;
        dcm4chex:service=AuditLogger,name=AUDITLOG
    &#60;/depends&#62;</programlisting>

        <para>The first <literal>&#60;depends&#62;</literal> element registers
        this Printer Service to the Print SCP service with the
        <literal>MBean</literal> named <literal>dcm4chex:service=PrintSCP</literal>,
        and the second element names the Audit Logger Service
        <literal>dcm4chex:service=AuditLogger,name=AUDITLOG</literal> which
        will be used.</para>

        <para>And in <filename>printscp-service.xml</filename>:</para>

        <programlisting>  &#60;mbean code=&#34;com.tiani.prnscp.scp.PrintScpService&#34; 
         name=&#34;dcm4chex:service=PrintSCP&#34;&#62;    
    &#60;depends optional-attribute-name=&#34;DcmServerName&#34;&#62;
        dcm4chex:service=DcmServer,name=DCMSRV
    &#60;/depends&#62;
    &#60;depends optional-attribute-name=&#34;AuditLoggerName&#34;&#62;
        dcm4chex:service=AuditLogger,name=AUDITLOG
    &#60;/depends&#62;</programlisting>

        <para>The first <literal>&#60;depends&#62;</literal> element registers
        this Print SCP Service to the DICOM server with the
        <literal>MBean</literal> named <literal>dcm4chex:service=DcmServer,name=DCMSRV</literal>,
        the second element defines the dependency to the used Audit Logger
        Service as in <filename>printer-service.xml</filename>.</para>

        <para>Every service has to have a different MBean name. Hence, when
        several instances of the same service type are configured, the MBean
        name specified in its configuration file must be different. E.g., if
        you are running two DICOM servers, you have to change the MBean name
        of the second instance in its configuration file from the default
        value of <literal>dcm4chex:service=DcmServer,name=DCMSRV</literal> to<literal>
        dcm4chex:service=DcmServer,name=DCMSRV2</literal>, for example.</para>
      </section>
    </section>

    <section id="local-luts">
      <title id="lut">Local Lookup Tables</title>

      <para>jPrint supports the configuration of local lookup tables at the
      Print Server. This feature is intended as workaround for Print Composers
      which do not provide proper P-LUTs via the N-CREATE Service of the DICOM
      Presentation Lookup Table SOP Class. The use of local LUTs only needs to
      be configured for Print Composers with no, or inappropriate, support of
      the DICOM P-LUT SOP Class.</para>

      <para>A local LUT can be defined by an explicit DICOM file with a
      Presentation LUT Information Object or by 1-3 parameters of a
      proprietary generation function for S-shaped P-LUTs.</para>

      <para>A Print SCU can select these local LUTs by providing a value for
      the Film Box attribute (2010,0150) Configuration Information:</para>

      <table>
        <title>Configuration Information Syntax</title>

        <tgroup cols="2">
          <colspec colwidth="180" />

          <thead>
            <row>
              <entry>Configuration Information</entry>

              <entry>applied LUT</entry>
            </row>
          </thead>

          <tbody>
            <row>
              <entry>shape=IDENTITY</entry>

              <entry>Interprets pixel values as P-values</entry>
            </row>

            <row>
              <entry>shape=LIN OD</entry>

              <entry>Interprets pixel values as linear optical density over
              the range of Min Density (2010,0120) and Max Density
              (2010,1030).</entry>
            </row>

            <row>
              <entry>shape=&#60;LUT-name&#62;</entry>

              <entry>P-LUT Information Object in file &#60;LUT-name&#62;.lut
              in directory <literal>server/default/conf/lut</literal>.</entry>
            </row>

            <row>
              <entry><literallayout>gamma=&#60;g&#62;
{with &#60;g&#62; in interval [0.1,10]}</literallayout></entry>

              <entry>Applies a LUT based on f(x) ~ x^(1/g):<variablelist><varlistentry><term>g
              &#62; 1</term><listitem><para>will increase the contrast in the
              dark and lighten the image as a whole,</para></listitem></varlistentry><varlistentry><term>g
              &#60; 1</term><listitem><para>will increase the contrast of
              brighten parts and darken then image as a whole.</para></listitem></varlistentry></variablelist></entry>
            </row>

            <row>
              <entry><literallayout>center=&#60;c&#62;,slope=&#60;s&#62;
{with &#60;c&#62; in interval [0,1],
and &#60;s&#62; in interval [0,10]} </literallayout></entry>

              <entry>Applies a S-shaped P-LUT which enhances the contrast
              around a defined center (c = 0.5 specifies middle of pixel value
              range), with the factor specified by slope (e.g.: s=2 doubles
              the contrast).</entry>
            </row>

            <row>
              <entry><literallayout>center=&#60;c&#62;,slope=&#60;s&#62;,gamma=&#60;g&#62;</literallayout></entry>

              <entry>Applies a P-LUT generated as combination of the S-shaped
              function defined by center=&#60;c&#62;,slope=&#60;s&#62; and the
              power function defined by gamma=&#60;g&#62;.</entry>
            </row>
          </tbody>
        </tgroup>
      </table>

      <para>These values can also be used in the Printer Service configuration
      <filename>server/default/deploy/printer-service.xml</filename>, to
      associate a LUT to the Calling AET of a Print SCU (s. Printer Service
      attribute <link linkend="ConfInfoForCallingAET">ConfigurationInformationForCallingAET</link>),
      in the (common) case that the Print SCU cannot be configured to provide
      a Configuration Information value as described above.</para>

      <para>The <link linkend="view-plut.jar">view-plut.jar</link> utility can
      be used to display the shape of P-LUTs specified by <literal>center=</literal><replaceable>&#60;c&#62;</replaceable><literal>,slope=</literal><replaceable>&#60;s&#62;</replaceable><literal>,gamma=</literal><replaceable>&#60;g&#62;</replaceable>.
      It also supports applying such P-LUTs on a DICOM image, showing it&#39;s
      effect on the image.</para>

      <para>The <link linkend="print-image.jar">print-image.jar</link> utility
      can be used to directly print a local DICOM image, with a P-LUT
      specified by a Configuration Information value, without the need for a
      separate DICOM Print Client.</para>
    </section>

    <section>
      <title id="adf">Annotation Display Formats</title>

      <para>jPrint provides DICOM Services for the Basic Annotation Box SOP
      Class, which allows a Print SCU to select from a set of preconfigured
      Annotation Display Formats based on the value of the Attribute
      Annotation Display Format ID (2010,0030) of the Basic Film Box and to
      set the values of it&#39;s editable text fields (=Annotation Boxes).</para>

      <para>If a Print Composer does not support the Basic Annotation Box SOP
      Class, the selection of the Annotation Display Format can be configured
      based on it&#39;s Calling AET (s. Printer Service configuration
      attribute <link linkend="AnnotationForCallingAET">AnnotationForCallingAET</link>).</para>

      <section>
        <title>ADF Configuration Files</title>

        <para>Annotation Display Formats are specified by text files located
        in directory <filename>server/default/conf/annotations</filename>. The
        file names are constrained to the format:</para>

        <para><replaceable>&#60;Annotation Display Format ID&#62;</replaceable><literal>.</literal><replaceable>&#60;N&#62;</replaceable><literal>.adf</literal></para>

        <variablelist>
          <varlistentry>
            <term><replaceable>&#60;Annotation Display Format ID&#62;</replaceable></term>

            <listitem>
              <para>ID used as the value of Attribute Annotation Display
              Format ID (2010,0030) of the Basic Film Box and in the <link
              linkend="AnnotationForCallingAET">AnnotationForCallingAET</link>
              Printer Service configuration attribute.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term><replaceable>&#60;N&#62;</replaceable></term>

            <listitem>
              <para>Number of text fields (=Annotation Boxes) defined by this
              format.</para>
            </listitem>
          </varlistentry>
        </variablelist>

        <para>The text files contains a list properties (key and element
        pairs). Every property occupies one line. Each line is terminated by a
        line terminator (line feed or carriage return + line feed).</para>

        <para>A line that contains only whitespace or whose first
        non-whitespace character is an ASCII <literal>#</literal> or
        <literal>!</literal> is ignored (thus, <literal>#</literal> or
        <literal>!</literal> indicate comment lines).</para>

        <para>The key consists of all the characters in the line starting with
        the first non-whitespace character and up to, but not including, the
        first ASCII <literal>=</literal>, <literal>:</literal>, or whitespace
        character. All remaining characters on the line become part of the
        associated value string. Within the value string, the ASCII escape
        sequences <literal>\t</literal>, <literal>\n</literal>,
        <literal>\r</literal>, <literal>\\</literal>, <literal>\&#34;</literal>,
        <literal>\&#39;</literal> and <literal>\ </literal>(a backslash and a
        space) are recognized and converted to single characters.</para>

        <para>The default configuration contains the definition for two
        Annotation Display Formats:</para>

        <variablelist>
          <varlistentry>
            <term><filename>server/default/conf/annotation/TITLE.5.adf</filename></term>

            <listitem>
              <para>Specifies Annotation Display Format <literal>TITLE</literal>:
              5 Annotation Boxes located on the four edges and one, with a
              larger font size, centered at the top of the page. Used for all
              DICOM prints with default
              server/default/deploy/printer-service.xml. Usually you will at
              least edit the specified <literal>Default Title</literal>.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term><filename>server/default/conf/annotation/NO_TITLE.4.adf</filename></term>

            <listitem>
              <para>Specifies Annotation Display Format <literal>NO_TITLE</literal>:
              Like Annotation Display Format <literal>TITLE</literal>, but
              without a centered Annotation Box at the top of the page. Used
              for print-outs made with <command>the print-image.jar</command>
              utility in the default configuration.</para>
            </listitem>
          </varlistentry>
        </variablelist>
      </section>

      <section>
        <title>ADF Properties</title>

        <para>Usually, annotations are printed near the page margin,
        surrounding the printed image(s). You can specify an inset describing
        the area which shall be used for the image(s) to print, from the
        actual printable area on the page (s. Print Service Attribute <link
        linkend="PageMargin">PageMargin</link>):</para>

        <table>
          <title>Inset Properties</title>

          <tgroup cols="2">
            <colspec colwidth="80" />

            <thead>
              <row>
                <entry align="center">Property</entry>

                <entry align="center">Description</entry>
              </row>
            </thead>

            <tbody>
              <row>
                <entry>inset.left</entry>

                <entry>Defines width of the border, in points, left from the
                printed image(s) to the left margin of the printable area on
                the page.</entry>
              </row>

              <row>
                <entry>inset.right</entry>

                <entry>Defines width of the border, in points, right from the
                printed image(s) to the right margin of the printable area on
                the page.</entry>
              </row>

              <row>
                <entry>inset.top</entry>

                <entry>Defines height of the border, in points, above the
                printed image(s) to the top margin of the printable area on
                the page.</entry>
              </row>

              <row>
                <entry>inset.bottom</entry>

                <entry>Defines height of the border, in points, below the
                printed image(s) to the bottom margin of the printable area on
                the page.</entry>
              </row>
            </tbody>
          </tgroup>
        </table>

        <para>E.g. <filename>server/default/conf/annotation/TITLE.5.adf:</filename></para>

        <programlisting>inset.left=0
inset.right=0
inset.top=20
inset.bottom=20</programlisting>

        <para>This defines a (minimal) margin of 20 points (1 point = 1/72
        inch) above and below the printed image inside the printable area, to
        accommodate the annotations. The actual distance between the border of
        the printed image and the page margin may be larger than defined by
        <literal>inset.</literal><replaceable>*</replaceable> properties
        because the aspect ratio of the image has to be preserved. So only the
        full width <emphasis>OR</emphasis> the full height of the area
        reserved for the image(s) may be used.</para>

        <para><xref linkend="fig-adf-inset" />shows the rectangle area for the
        printed image with a border for locating annotations on the page with
        portrait orientation defined by the Print Service Attribute <link
        linkend="PageMargin">PageMargin</link> and the <literal>inset.</literal><replaceable>*</replaceable>
        properties.</para>

        <figure id="fig-adf-inset">
          <title>Annotation Locations</title>

          <mediaobject>
            <imageobject>
              <imagedata fileref="../img/jPrint-ug2.gif" />
            </imageobject>
          </mediaobject>
        </figure>

        <para>Annotations can be located around the four edge points of the
        rectangle and around the four center points of the rectangle sides.
        Although possible, it&#39;s not quite useful to locate an annotation
        in the center of the rectangle, because there it overlaps with the
        printed image(s).</para>

        <para>Annotation Boxes defined by an Annotation Display Format are
        serially numbered, starting with &#34;1&#34;. Properties specific to
        an annotation box, as its <literal>x</literal> and <literal>y</literal>
        properties defining its location, are prefixed with the number (#) of
        the box. The location of the annotation text also depends on the
        specified horizontal and vertical alignment for that box.</para>

        <table>
          <title>Annotation Location and Alignment Properties</title>

          <tgroup cols="2">
            <colspec colwidth="80" />

            <thead>
              <row>
                <entry align="center">Property</entry>

                <entry align="center">Description</entry>
              </row>
            </thead>

            <tbody>
              <row>
                <entry>#.x</entry>

                <entry>Specifies the x position of annotation box # on the
                page. Possible values are <literal>left</literal>,
                <literal>center </literal> or <literal>right</literal>. An
                offset can be specified by appending the code value with
                <literal>+</literal> (=shift to right) or <literal>-</literal>
                (=shift to left) and its magnitude in points (1 point = 1/72
                inch).</entry>
              </row>

              <row>
                <entry>#.y</entry>

                <entry>Specifies the y position of annotation box # on the
                page. Possible values are <literal>top</literal>,
                <literal>center</literal> or <literal>bottom</literal>. An
                offset can be specified by appending the code value with
                <literal>+</literal> (=shift down) or <literal>-</literal>
                (=shift up) and its magnitude in points (1 point = 1/72 inch).</entry>
              </row>

              <row>
                <entry>#.align</entry>

                <entry><para>Specifies the horizontal alignment of the content
                of annotation box #. Possible values are <literal>left</literal>,
                <literal>center</literal> or <literal>right</literal>:</para>
                <inlinemediaobject><imageobject><imagedata
                fileref="../img/jPrint-ug4.gif" /></imageobject></inlinemediaobject></entry>
              </row>

              <row>
                <entry>#.valign</entry>

                <entry><para>Specifies the vertical alignment of the content
                of annotation box #.. Possible values are <literal>top</literal>,
                <literal>center</literal> or <literal>bottom</literal>.</para><inlinemediaobject><imageobject><imagedata
                fileref="../img/jPrint-ug3.gif" /></imageobject></inlinemediaobject></entry>
              </row>
            </tbody>
          </tgroup>
        </table>

        <para>Typically, annotations are positioned outside of the rectangle
        area for the printed image(s). That constrains the configurable
        horizontal and vertical alignment and the direction (=sign) of an
        optional location shift (=offset) to be dependent on the configured
        location:</para>

        <table>
          <title>Alignment and Offset Constrains for Annotation Box Positions</title>

          <tgroup cols="2">
            <colspec colwidth="100" />

            <colspec colwidth="100" />

            <thead>
              <row>
                <entry align="center">Position</entry>

                <entry align="center">Alignment</entry>
              </row>
            </thead>

            <tbody>
              <row>
                <entry><literallayout>#.x=left[-offset]
#.y=top[-offset]</literallayout></entry>

                <entry><literallayout>#.align=right
or
#.valign=bottom</literallayout></entry>
              </row>

              <row>
                <entry><literallayout>#.x=center
#.y=top[-offset]</literallayout></entry>

                <entry><literallayout>#.valign=bottom</literallayout></entry>
              </row>

              <row>
                <entry><literallayout>#.x=right[+offset]
#.y=top[-offset]</literallayout></entry>

                <entry><literallayout>#.align=left
or
#.valign=bottom</literallayout></entry>
              </row>

              <row>
                <entry><literallayout>#.x=left[-offset]
#.y=center</literallayout></entry>

                <entry><literallayout>#.align=right</literallayout></entry>
              </row>

              <row>
                <entry><literallayout>#.x=right[+offset]
#.y=center</literallayout></entry>

                <entry><literallayout>#.align=left</literallayout></entry>
              </row>

              <row>
                <entry><literallayout>#.x=left[-offset]
#.y=bottom[+offset]</literallayout></entry>

                <entry><literallayout>#.align=right
or
#.valign=top</literallayout></entry>
              </row>

              <row>
                <entry><literallayout>#.x=center
#.y=bottom[+offset]</literallayout></entry>

                <entry><literallayout>#.valign=top</literallayout></entry>
              </row>

              <row>
                <entry><literallayout>#.x=right[+offset]
#.y=bottom[+offset]</literallayout></entry>

                <entry><literallayout>#.align=left
or
#.valign=top</literallayout></entry>
              </row>
            </tbody>
          </tgroup>
        </table>

        <para>Further ADF properties specifies the default content of the
        annotation box and the font name, size and color to render the text.</para>

        <table>
          <title>Further Annotation Properties</title>

          <tgroup cols="2">
            <colspec colwidth="80" />

            <thead>
              <row>
                <entry align="center">Property</entry>

                <entry align="center">Description</entry>
              </row>
            </thead>

            <tbody>
              <row>
                <entry>#</entry>

                <entry>Specifies the default content (text) of this annotation
                box. The text may have embedded strings of the form
                <replaceable>$KEYWORD$</replaceable> which are replaced by
                their corresponding values. See <xref
                linkend="keyword-substitution" />.</entry>
              </row>

              <row>
                <entry>[#.]font.name</entry>

                <entry>Specifies Font (family) name, used for text rendering.
                Possible values are dependent on the printer, but at least
                <literal>Serif</literal> and <literal>SansSerif</literal> are
                supported by any printer (driver).</entry>
              </row>

              <row>
                <entry>[#.]font.size</entry>

                <entry>Specifies Font point size used for text rendering.
                Possible values are dependent on the printer, but font sizes
                between 8 and 24 should be supported by any printer (driver).</entry>
              </row>

              <row>
                <entry>[#.]font.style</entry>

                <entry>Specifies font style used for text rendering. Possible
                values: <literal>plain</literal>, <literal>italic</literal>,
                <literal>bold</literal>, <literal>italic+bold</literal></entry>
              </row>

              <row>
                <entry>[#.]font.color</entry>

                <entry>Specifies color used for text rendering. Possible
                values: <literal>black</literal>, <literal>blue</literal>,
                <literal>cyan</literal>, <literal>gray</literal>,
                <literal>green</literal>, <literal>magenta</literal>,
                <literal>orange</literal>, <literal>pink</literal>,
                <literal>red</literal>, <literal>white</literal>,
                <literal>yellow</literal>.</entry>
              </row>
            </tbody>
          </tgroup>
        </table>

        <para>Font attributes can be specified individually for each
        annotation box (=with the #. key prefix) or globally for all
        annotation boxes (without #. key prefix), whereas the
        individually-specified value overwrites a possibly globally-specified
        value for the same attribute.</para>

        <para>E.g. <filename>server/default/conf/annotation/TITLE.5.adf</filename></para>

        <programlisting>font.name=Serif
font.size=8
font.style=plain
font.color=black

1=Default Title
1.font.size=16
1.x=center
1.y=top-2
1.align=center
1.valign=bottom</programlisting>

        <para>This defines an 8-point Serif, plain style, black font as the
        default font. The size of the font used for the first annotation box
        is overwritten to be 16 points, so the <literal>Default Title</literal>,
        specified as default content, will be printed in Serif 16 plain style,
        black, horizontally-centered with the bottom line of the text 2 points
        above the top of the area reserved for the printed image(s).</para>
      </section>

      <section id="keyword-substitution">
        <title>Keyword substitution</title>

        <para>The default text for the annotation box may have embedded
        strings of the form <replaceable>$KEYWORD$</replaceable> which are
        replaced by their corresponding values just before the Print Job for
        this page is transmitted to the connected printer:</para>

        <variablelist>
          <varlistentry>
            <term><literal>$SESSION_LABEL$</literal></term>

            <listitem>
              <para>The value of Attribute Film Session Label (2000,0050) of
              the Basic Film Session provided by the Print Composer or the
              Print Service Configuration Attribute <link
              linkend="SessionLabel">SessionLabel</link>.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term><literal>$CALLING_AET$</literal></term>

            <listitem>
              <para>The calling Application Entity Title of the Print
              Composer.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term><literal>$CALLED_AET$</literal></term>

            <listitem>
              <para>The called Application Entity Title associated with the
              Printer Service used.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term><literal>$DATE$</literal></term>

            <listitem>
              <para>The current date in the format defined by the Print
              Service Configuration Attribute <link linkend="DateFormat">DateFormat</link>.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term><literal>$TIME$</literal></term>

            <listitem>
              <para>The current time in the format defined by the Print
              Service Configuration Attribute <link linkend="TimeFormat">TimeFormat</link>.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term><literal>$PAGE$</literal></term>

            <listitem>
              <para>The number of the current page in a DICOM Print Job
              initiated for a Film Session which contains multiple Film Boxes
              (=pages). However, usually, Print Composers initiate a Print Job
              for every Film Box individually. Then the page number is not
              available to jPrint and <literal>$PAGE$</literal> will always be
              replaced by <literal>&#34;1</literal>&#34;!</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term><literal>$PAGES$</literal></term>

            <listitem>
              <para>The total number of pages printed in a DICOM Print Job
              initiated for a Film Session (=page) which contains multiple
              Film Boxes. However, usually, Print Composers initiate a Print
              Job for every Film Box individually. Then the total number of
              pages is not available to jPrint and <literal>$PAGE$</literal>
              will always be replaced by &#34;<literal>1</literal>&#34;!</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term><literal>$LICENSE_CN$</literal></term>

            <listitem>
              <para>The name of the license owner, encoded in the license file
              <filename>server/default/conf/license.jks</filename>. If no
              license file was found by jPrint at start up,
              <literal>$LICENSE_CN$</literal> will be replaced by nobody.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term><literal>$LICENSE_ENDDATE$</literal></term>

            <listitem>
              <para>The expire date of the license <filename>server/default/conf/license.jks</filename>
              in the format defined by Print Service Configuration Attribute
              <link linkend="DateFormat">DateFormat</link>. If no license file
              was found by jPrint at start up, <literal>$LICENSE_ENDDATE$</literal>
              will be replaced by the current date.</para>
            </listitem>
          </varlistentry>
        </variablelist>

        <para>So, for example, <filename>server/default/conf/annotation/TITLE.5.adf:</filename></para>

        <programlisting>3=printed by $CALLED_AET$\nat $DATE$ $TIME$
3.x=right
3.y=top-2
3.align=right
3.valign=bottom</programlisting>

        <para>This defines the (default) content of the third Annotation Box
        at the upper right corner of the page as having two lines -
        &#34;\n&#34; causes the line break, with the first line including the
        Called AET associated with the Printer Service used, and the second
        line including the current date and time.</para>
      </section>
    </section>

    <section>
      <title id="tls">Secure Mode (DICOM-TLS)</title>

      <para></para>
    </section>

    <section>
      <title id="log4j">Logging Behavior</title>

      <para></para>
    </section>
  </section>

  <section id="printer-calibration">
    <title>Printer Calibration</title>

    <para>To achieve hard copy presentation quality and consistency compliant
    to the standard defined in DICOM Part 14: Grayscale Standard Display
    Function, jPrint has to quantify the characteristic curve of any connected
    printers. This procedure is called Printer Calibration, and shall be
    repeated in regular intervals, but particularly after any printer
    adjustment has been made (e.g. toner refill).</para>

    <section>
      <title>The Test Patterns</title>

      <para>The jPrint distribution package contains several test patterns
      (stored as DICOM images) which are used to determine the printer
      characteristics and to evaluate the print quality after the calibration:</para>

      <informaltable frame="none">
        <tgroup cols="2">
          <colspec align="center" colwidth="120" />

          <tbody>
            <row>
              <entry><mediaobject><imageobject><imagedata
              fileref="../img/DSI16.gif" format="GIF" /></imageobject></mediaobject></entry>

              <entry><filename>images/DSI16.dcm</filename>: Philips
              &#34;dsitest&#34; image with 16 equidistant boxes filled with
              shades of gray from black to white. Used for manual measurement
              of printer characteristics and for quantitative verification of
              proper Printer Calibration.</entry>
            </row>

            <row>
              <entry><mediaobject><imageobject><imagedata
              fileref="../img/DSI256.gif" format="GIF" /></imageobject></mediaobject></entry>

              <entry><filename>images/DSI256.dcm</filename>: Derived from the
              DSI16 pattern, by splitting each of the 16 boxes again into 16
              different shades, so the entire pattern contains 256 gray
              shades. Used for calculating the printer characteristic curve by
              jPrint from a scan of an up-to-date print-out of this image and
              of a scan of a reference sheet (also with this pattern) with
              known OD values.</entry>
            </row>

            <row>
              <entry><mediaobject><imageobject><imagedata
              fileref="../img/WEDGE8.gif" format="GIF" /></imageobject></mediaobject></entry>

              <entry><filename>images/WEDGE8.dcm</filename>: 8-bit Wedge
              pattern featuring a transition from black to white in 45 degree
              angled lines with 256 different shades of gray. Used for
              qualitative verification of the print quality.</entry>
            </row>

            <row>
              <entry><mediaobject><imageobject><imagedata
              fileref="../img/WEDGE12.gif" format="GIF" /></imageobject></mediaobject></entry>

              <entry><filename>images/WETestDGE12.dcm</filename>: 12-bit Wedge
              pattern contains four stripes with a transition from black to
              white in 45 degree angled lines with 4096 different shades of
              gray. Used for qualitative verification of the print quality.</entry>
            </row>

            <row>
              <entry><mediaobject><imageobject><imagedata
              fileref="../img/ASPECT.gif" format="GIF" /></imageobject></mediaobject></entry>

              <entry><filename>images/ASPECT.dcm</filename>: The Pixel Aspect
              Ratio pattern shows a transition from black to white. The source
              image contains a pixel aspect ratio of 4:1 (512 x 128 pixels).
              Correctly printed, the image has a square shape.</entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>

      <para>Test patterns can be printed by using the utility <link
      linkend="print-image.jar">print-image.jar</link>.</para>
    </section>

    <section>
      <title>Collecting Printer Characteristics</title>

      <para>There are two options to determine the characteristic curve of the
      connected printer(s):</para>

      <itemizedlist>
        <listitem>
          <para>Manually measuring the optical density (OD) values
          corresponding to the different device driving levels (DDLs) on the
          print-out of the <literal>DSI256</literal> or <literal>DSI16</literal>
          pattern using an optical densitometer. Or,</para>
        </listitem>

        <listitem>
          <para>Scanning a print-out of the <literal>DSI256</literal> pattern
          and a reference sheet with the same pattern by a digital scanner and
          store the scans as JPEG files into the JPrint calibration
          subdirectories, so jPrint can calculate the OD values on the scanned
          print-out by comparing it with the scan of the <emphasis>reference</emphasis>
          pattern which has known OD values.</para>
        </listitem>
      </itemizedlist>

      <para>For color printers, two characteristic curves have to be
      determined: one for monochrome and one for color mode.</para>

      <section>
        <title id="od-measurement">OD Measurement with Densitometer</title>

        <para>You can decide between measurement of only 16 OD values related
        to equidistant DDLs, then jPrint will estimate the OD values for
        intermediate DDLs by interpolation, or you can take the effort and
        measure the OD values of all 256 different DDLs manually.</para>

        <para>Depending on your decision, you have to print out the
        <filename>images/DSI16.dcm</filename> or the <filename>images/DSI256.dcm</filename>
        pattern, using the <link linkend="print-image.jar"><command>print-image.jar</command></link>
        utility:</para>

        <programlisting>$ cd jprint-1.2.1/bin
$ java -jar print-image.jar -a <replaceable>&#60;AET&#62;</replaceable> ../images/DSI16.dcm
<emphasis>or</emphasis>
$ java -jar print-image.jar -a <replaceable>&#60;AET&#62;</replaceable> ../images/DSI256.dcm</programlisting>

        <para>With <replaceable>&#60;AET&#62;</replaceable> as the configured
        AET associated with this printer (default: <literal>TIANI_PRINT</literal>).</para>

        <para>Start the measurement with the white box at the bottom-left
        corner and set the zero point of the densitometer to this measurement.
        Including the zero-point, continue recording the measurements
        measuring toward increasing OD values.</para>

        <para>The following figure shows the order of the measurements for the
        16 OD values on the DSI16 pattern.</para>

        <figure label="">
          <title>Order of the OD measurements in DSI16 pattern</title>

          <mediaobject>
            <imageobject>
              <imagedata fileref="../img/SqDSI16.gif" />
            </imageobject>
          </mediaobject>
        </figure>

        <para>In the case of the DSI256 pattern, each of the 16 boxes is
        itself divided into 4x4 boxes, within which the ODs have to be
        measured individually in the same winding order as the boxes of the
        main pattern.</para>

        <para>Enter the measurements in a text file - one OD value per line -
        and store it as <filename><replaceable>&#60;AET&#62;</replaceable>.monochrome.ods</filename>
        in the <filename>server/default/conf/calibration</filename>/
        subdirectory of the jPrint installation.</para>

        <para>For color printers, you have also to print the test pattern in
        color mode:</para>

        <programlisting>$ java -jar print-image.jar -c -a <replaceable>&#60;AET&#62;</replaceable> ../images/DSI16.dcm
<emphasis>or</emphasis>
$ java -jar print-image.jar -c -a <replaceable>&#60;AET&#62;</replaceable> ../images/DSI256.dcm</programlisting>

        <para>Storing the measurements of this print-out as text file called
        <filename><replaceable>&#60;AET&#62;</replaceable>.color.ods</filename>
        in the <filename>server/default/conf/calibration</filename>/
        subdirectory of the jPrint installation.</para>

        <para>You will need to restart the jPrint server after recording these
        changes for them to take effect.</para>
      </section>

      <section id="sODcalcFromScans">
        <title>OD Calculation from Scans</title>

        <para>jPrint supports the use of a common A4 flatbed scanner to
        determine the ODs of the print-out of <filename>images/DSI256.dcm</filename>
        (<emphasis>not</emphasis> images/DSI16.dcm) pattern with defined DDLs.</para>

        <para>To determine the characteristic curve of the scanner, you need a
        reference paper sheet with the <filename>images/DSI256.dcm</filename>
        pattern with known ODs.</para>

        <figure>
          <title>DSI256 reference sheet</title>

          <mediaobject>
            <imageobject>
              <imagedata fileref="../img/PageDSI256.gif" />
            </imageobject>
          </mediaobject>
        </figure>

        <para>You will receive a reference page corresponding to these OD
        values defined in <filename>server/default/conf/calibration/DSI256.ods</filename>
        of the default configuration by post after ordering a (evaluation)
        license of jPrint at <ulink
        url="http://www.tiani.com/products/jprint/">http://www.tiani.com/products/jprint/</ulink>.</para>

        <para>If a densitometer is available, you may also create your own
        reference sheet, by measuring the 256 OD values of a print out of
        <filename>images/DSI256.dcm</filename> and store them in
        <filename>server/default/conf/calibration/DSI256.ods</filename> (s.
        <xref linkend="od-measurement" />).</para>

        <para>Scan this DSI256 reference sheet, landscape or portrait
        orientation does not matter, and store it as JPEG file:
        <filename>server/default/conf/calibration/DSI256.jpg</filename>. A
        scan resolution of ~300dpi is sufficient.</para>

        <para>Print out the <filename>images/DSI256.dcm</filename> pattern,
        using the <link linkend="print-image.jar">print-image.jar</link>
        utility:</para>

        <programlisting>$ cd jprint-1.2.1/bin
$ java -jar print-image.jar -a <replaceable>&#60;AET&#62;</replaceable> ../images/DSI256.dcm</programlisting>

        <para>With <replaceable>&#60;AET&#62;</replaceable> as the configured
        Application Entity Title associated with this printer (default:
        <literal>TIANI_PRINT</literal>).</para>

        <para>Scan the <filename>images/DSI256.dcm</filename> print-out -
        <emphasis>with the same scanner parameters</emphasis> you used when
        scanning the reference sheet before - and store it as JPEG file:
        <filename>server/default/conf/calibration/<replaceable>&#60;AET&#62;</replaceable>.monochrome/<replaceable>&#60;anyFilename&#62;</replaceable>.jpg</filename>.</para>

        <para>For color printers, you have also to print <filename>images/DSI256.dcm</filename>
        in color mode:</para>

        <programlisting>$ java -jar print-image.jar -c -a <replaceable>&#60;AET&#62;</replaceable> ../images/DSI256.dcm</programlisting>

        <para>Scan that print-out and store it as JPEG file
        <filename>server/default/conf/calibration/<replaceable>&#60;AET&#62;</replaceable>.color/<replaceable>&#60;anyFilename&#62;</replaceable>.jpg</filename>.</para>

        <para>jPrint will calculate the characteristic curve from the scans
        when it performs the next print job. The analysis of the scans can
        take some time - depending upon the scanning resolution used. You may
        see the corresponding status messages in the console log:</para>

        <programlisting>21:27:14,330 INFO  [PrinterService] Calibrating Printer TIANI_PRINT, chromaticity=monochrome
21:28:30,725 INFO  [PrinterService] Printer OD range [monochrome]: total=0.0-1.62, used=0.0-1.62, DDL=255-6
21:28:30,745 INFO  [PrinterService] Calibrated Printer TIANI_PRINT, chromaticity=monochrome</programlisting>

        <para>jPrint stores the calculated characteristic curve in
        <filename>server/default/conf/calibration/<replaceable>&#60;AET&#62;</replaceable>.monochrome.ods</filename>
        or, for color mode print, in <filename>server/default/conf/calibration/<replaceable>&#60;AET&#62;</replaceable>.color.ods</filename>,
        so the calculation has only be performed one time.</para>

        <para>This calculation can be triggered by using the print-image.jar
        utility:</para>

        <programlisting>$ java -jar print-image.jar -a <replaceable>&#60;AET&#62;</replaceable> -i shape=IDENTITY ../images/WEDGE8.dcm</programlisting>

        <para>to print a test pattern. The option <literal>-i shape=IDENTITY</literal>
        forces jPrint to print the image calibrated according to the Grayscale
        Standard Display Function (GSDF). Without that, the pixel values are
        directly used as DDL, so jPrint would not need to know the printer
        characteristics to perform the print and no calculation of the
        characteristic curve would be triggered.</para>

        <para>jPrint always uses the most recent scan file in directory
        <filename>server/default/conf/calibration/&#60;AET&#62;.monochrome/</filename>
        (<filename>server/default/conf/calibration/&#60;AET&#62;.color/</filename>
        for prints in color mode) to calculate the printer characteristics. So
        you only need to drop scans of current print-outs of
        <filename>images/DSI256.dcm</filename> into these directories to keep
        the Printer Calibration up-to-date with any, possibly changing,
        printer characteristics.</para>

        <para>You may evaluate the printer characteristics from the stored
        scans by using the <link linkend="view-printerODs.jar">view-printerODs.jar</link>
        utility. This tool is particularly useful if you are experimenting
        with different printer configurations and need to evaluate the effect
        of the characteristic curve(s), or to evaluate the drift of the a
        single printer&#39;s characteristics over time.</para>
      </section>
    </section>

    <section>
      <title>Verification of the Printer Calibration</title>

      <section>
        <title>Testing the Visual Image Quality</title>

        <para>Initiate the calibrated print-out of the WEDGE8 pattern by:</para>

        <programlisting>$ cd jprint-1.2.1/bin
$ java -jar print-image.jar -a <replaceable>&#60;AET&#62;</replaceable> -i shape=IDENTITY ../images/WEDGE8.dcm</programlisting>

        <para>With <replaceable>&#60;AET&#62;</replaceable> as the configured
        Application Entity Title associated with this printer (default:
        <literal>TIANI_PRINT</literal>). The option <literal>-i shape=IDENTITY</literal>
        causes jPrint to print the image calibrated according to the DICOM
        Grayscale Standard Display Function (GSDF).</para>

        <para>The hardcopy should not contain visible contours - the
        transition from dark to bright within the wedge should be smooth.</para>

        <para>You may also compare the result against the print-out of the
        same pattern without calibration by:</para>

        <programlisting>$ java -jar print-image.jar -a <replaceable>&#60;AET&#62;</replaceable> ../images/WEDGE8.dcm</programlisting>

        <para>For color printers, repeat the check for a calibrated print-out
        of the WEDGE8 pattern in color mode:</para>

        <programlisting>$ java -jar print-image.jar -c -a <replaceable>&#60;AET&#62;</replaceable> -i shape=IDENTITY ../images/WEDGE8.dcm</programlisting>
      </section>

      <section>
        <title>Quantitative Verification of the Printer Calibration to GSDF</title>

        <para>If a densitometer is available, you can determine the derivation
        of the Printer Calibration to the DICOM Grayscale Standard Display
        Function (GSDF), using a Microsoft Excel or OpenOffice.org spreadsheet
        included in the jPrint distribution:</para>

        <para>Initiate the calibrated print-out of the DSI16 pattern by:</para>

        <programlisting>$ cd jprint-1.2.1/bin
$ java -jar print-image.jar -a <replaceable>&#60;AET&#62;</replaceable> -i shape=IDENTITY ../images/DSI16.dcm</programlisting>

        <para>With <replaceable>&#60;AET&#62;</replaceable> as the configured
        Application Entity Title associated with this printer (default:
        <literal>TIANI_PRINT</literal>). The option <literal>-i shape=IDENTITY</literal>
        causes jPrint to print the image calibrated according to the DICOM
        Grayscale Standard Display Function (GSDF).</para>

        <para>Open the Hardcopy Calibration Form <filename>doc/gsdf_od.xls</filename>
        (Microsoft Excel) or <filename>doc/gsdf_od.sxc</filename>
        (OpenOffice.org Spreadsheet). It contains two tables: the first table
        is used to enter the measured optical density (OD) values and some
        administrative data, the second one is automatically filled.</para>

        <para>Enter the same value <literal>for Illumination</literal> as
        configured in <link linkend="printer-service"><filename>server/default/deploy/printer-service.xml</filename></link>
        (default: 150). For reflective media, and so for a paper printer, the
        value for <literal>Reflected Light</literal> must be set to 0.</para>

        <para>Start the measurement with the white box at the left bottom
        corner and set the zero point of the densitometer to this measurement.
        Continue with the measurements with increasing OD values in the order
        shown in the following figure:</para>

        <figure label="">
          <title>Order of the OD measurements in DSI16 pattern</title>

          <mediaobject>
            <imageobject>
              <imagedata fileref="../img/SqDSI16.gif" />
            </imageobject>
          </mediaobject>
        </figure>

        <para>And enter the values in the spreadsheet fields
        <literal>measured Box #1</literal> - <literal>measured Box #16</literal>.</para>

        <figure>
          <title>Spreadsheet gsdf_od - Table: Input</title>

          <mediaobject>
            <imageobject>
              <imagedata fileref="../img/gsdf_od1.gif" scale="80" />
            </imageobject>
          </mediaobject>
        </figure>

        <para>Change to the &#34;Output&#34; table and evaluate the result.
        The maximal relative derivation of any measurement from the calculated
        GSDF value should not be more than 10%.</para>

        <figure>
          <title>Spreadsheet gsdf_od - Table: Output</title>

          <mediaobject>
            <imageobject>
              <imagedata fileref="../img/gsdf_od2.gif" scale="80" />
            </imageobject>
          </mediaobject>
        </figure>
      </section>
    </section>
  </section>

  <section>
    <title>Utilities</title>

    <para></para>

    <section>
      <title id="check-license.jar">check-license.jar</title>

      <para>The check-license utility is used to examine your license file
      (called <filename>license.jks</filename> by default). It is used as
      follows:</para>

      <programlisting>$ java -jar check-license.jar

Usage: java -jar check-license.jar FILE [passwd]</programlisting>

      <para>To check if your license is valid for your host, execute the
      command <command>java -jar check-license.jar</command> in the
      <command>bin/</command> directory of the jPrint distribution, replacing
      <emphasis>FILE</emphasis> with the location of your license file.</para>
    </section>

    <section>
      <title id="list-printers.jar">list-printers.jar</title>

      <para>The list-printers utility lists any available printer names that
      may be referenced by the <literal>PrinterName</literal> attribute in the
      printer&#39;s XML service description file (the default printer&#39;s
      service file is called <filename>printer-service.xml</filename>). It is
      used as follows:</para>

      <programlisting>$ java -jar list-printers.jar
Available Printers:
MINOLTA
MINOLTA_A3
xerox</programlisting>
    </section>

    <section>
      <title id="print-image.jar">print-image.jar</title>

      <para>The print-image utility is used to send an image to any registered
      Printer Services running under the local jPrint server to be queued for
      a print job. It is used as follows:</para>

      <programlisting>$ java -jar print-image.jar -h

Usage: java -jar print-image.jar [OPTIONS] FILE

Print DICOM image in FILE

Options:
 -a, --aet=AET   print on printer bound to specified AET. Default: TIANI_PRINT
 -i, --info=CFG  print image with specified Configuration Information
 -c, --color     print image in color print mode (default grayscale)
 -h, --help      show this help and exit</programlisting>
    </section>

    <section>
      <title id="view-plut.jar">view-plut.jar</title>

      <para>The view-plut utility can be started by entering the command:
      <command>java -jar view-plut.jar</command> in the <filename>bin/</filename>
      directory of your jPrint distribution.</para>

      <para>This utility is meant to be used a simple way to manipulate a
      P-LUT and immediately see it&#39;s effect on a DICOM image. It can apply
      a P-LUT on monochrome images (with or without window levels) and on
      color images.</para>

      <para>To open an image choose <command>File &#62; Open</command> from
      the menu and select the DICOM image to open. In the right panel, the
      P-LUT Panel, you will see the (identity) P-LUT function and a histogram
      (for monochrome images only). If a window exists in the image the P-LUT
      will be defined over the window range only. The window itself is shown
      as a shaded gray region and may extend outside of the panel if it is
      large.</para>

      <para>The P-LUT curve may be adjusted by manipulating three parameters:
      the <emphasis>gamma</emphasis>, <emphasis>slope</emphasis> and
      <emphasis>center</emphasis>, which are shown in the top-left corner of
      the P-LUT Panel. They are adjusted using the mouse as follows:</para>

      <itemizedlist>
        <listitem>
          <para><emphasis role="bold">Gamma:</emphasis> Right-click and drag
          to the left the decrease and to the right to increase the gamma
          parameter.</para>
        </listitem>

        <listitem>
          <para><emphasis role="bold">Slope:</emphasis> Left-click and drag to
          the left the decrease and to the right to increase the gamma
          parameter.</para>
        </listitem>

        <listitem>
          <para><emphasis role="bold">Center:</emphasis> Left-click on the red
          center-line and drag up and down to adjust the center parameter.</para>
        </listitem>

        <listitem>
          <para><emphasis role="bold"><emphasis>Reset curve</emphasis>:</emphasis>
          Right-click to reset to a linear P-LUT.</para>
        </listitem>
      </itemizedlist>

      <para>Alternatively, to have a P-LUT chosen according to the histogram
      characteristic (only monochrome images may have a histogram), choose
      <command>Process &#62; Equalize Histogram</command> from the menu.</para>

      <para>The view-plut utility can also export or import P-LUTs using a
      P-LUT stored in DICOM format in a file or a plain text file containing
      one P-LUT entry per line in the range [0..255], inclusive.</para>

      <para>To print the current to a local jPrint Print Server, you can
      choose <command>File &#62; Print</command> from the menu. The AET that
      will be called is set using the command-line option &#34;--aet
      &#60;AET&#62;&#34; (or &#34;-a &#60;AET&#62;&#34;) when starting the
      view-plut utility. See below for more on the view-plut command-line
      options.</para>

      <programlisting>$ java -jar view-plut.jar --help
Usage: java -jar view-plut.jar [OPTIONS]

Used to view the effect of presentation LUTs on DICOM images.
Options:
 -t --threshold   Specifies the maximum threshold of differences
                  to treat the components of RGB values as gray values.
                  Specified as an integer from 0..255.
 -a --aet         The called AET of a print server for printing images
 -h --help        show this help and exit</programlisting>
    </section>

    <section>
      <title id="view-printerODs.jar">view-printerODs.jar</title>

      <para>The view-printerODs utility can be started by entering the
      command: <command>java -jar view-printerODs.jar</command> in the
      <filename>bin/</filename> directory of your jPrint distribution.</para>

      <para>You should now choose <command>Curve &#62; Load...</command> from
      the menu and select the JPEG file of your scanned <filename>DSI256.dcm</filename>
      print-out located in the calibrated printer directory. The utility will
      automatically locate the <filename>DSI256.ods</filename> file (one
      directory up, in <filename>server/default/conf/calibration/</filename>)
      which contains the known OD values for the reference DSI256 pattern. The
      utility will then analyze the scan file you selected (which will take
      some time, depending upon the resolution of the file and the speed of
      your computer). After the calculation, you will be shown the DICOM
      Grayscale Standard Display Function (GSDF) along with the calculated OD
      values for your scan file plotted against the Device Driving Level
      (DDL).</para>

      <para>You may load any number of curves for a printer by simply
      selecting the scan file that lies in the <filename>&#60;AET&#62;.monochrome</filename>
      or <filename>&#60;AET&#62;.color</filename> directories where
      <emphasis>&#60;AET&#62;</emphasis> corresponds to the Application Entity
      Title assigned to that printer configuration. <emphasis>Note: Trying to
      load a scan file from elsewhere will result in the reference OD file not
      to be found, thereby generating an error dialog.</emphasis></para>

      <para>You can select a curve by clicking its button on the panel along
      the bottom of the window. Selecting a curve will highlight the curve and
      calculate the difference between the selected curve and the GSDF curve
      (in black). The difference will be shown by a light blue curve on the
      graph.</para>

      <para>Right-clicking on a curve&#39;s button will display a menu from
      which you can remove a curve or export the curve data to a plain text
      file. The latter option is useful to record the actual values so that
      they may be further analyzed in a spreadsheet application, for example.</para>
    </section>
  </section>

  <section id="jprint-with-jaudit">
    <title>jPrint with jAudit</title>

    <para>Not yet written.</para>
  </section>
</article>